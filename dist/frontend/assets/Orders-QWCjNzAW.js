import{j as e}from"./framer-motion-CP1hDTrg.js";import{r as t,a as r,b as a}from"./react-vendor-CFOUl9e9.js";import{L as s}from"./Layout-D0rQz-4W.js";import{c as d,b as n,a as i,g as l}from"./index-Zg8dsWBS.js";import{F as o}from"./FileUpload-DdCe1LmD.js";import{D as c,u as m,w as x,E as u,a as g}from"./jspdf.plugin.autotable-BWxvZjXE.js";import{f as h}from"./currency-CLTscsdx.js";import"./Footer-D5Bc2McR.js";import"./lucide-Jis9dCxC.js";const p=(e,t)=>{(new Date).toISOString()};function y(){const[y,b]=t.useState([]),[j,v]=t.useState(!0),[k,N]=t.useState(0),[f,w]=t.useState(0),[S,_]=t.useState(0),[C,P]=t.useState(0),{isConnected:I}=d(),[A,D]=t.useState("all"),[L,O]=t.useState("orderId"),[U,$]=t.useState("asc"),[M,T]=t.useState(""),[E,q]=t.useState(!1),[F,R]=t.useState(null),[z,V]=t.useState([]),[B,W]=t.useState({userId:"",deliveryNotes:""}),[J,G]=t.useState(!1),[H,K]=t.useState({reason:"",returnItems:[]}),[Q,Y]=t.useState(()=>{const e=localStorage.getItem("orders-processing-errors");return e?JSON.parse(e):[]}),[Z,X]=t.useState(!1),[ee,te]=t.useState(!1),[re,ae]=t.useState(null),[se,de]=t.useState({pricePerUnit:0,paymentMethod:"cash"}),[ne,ie]=t.useState(!1),[le,oe]=t.useState(null),[ce,me]=t.useState(!1),[xe,ue]=t.useState({customerName:"",customerPhone:"",customerEmail:"",addressLine1:"",addressLine2:"",landmark:"",city:"",state:"",pincode:"",country:"India",alternatePhone:"",isVerifiedAddress:!1,deliveryNote:"",productName:"",productId:"",quantity:1,unitPrice:0,orderSource:"Manual",state_code:"",gst_number:""}),[ge,he]=t.useState([]),[pe,ye]=t.useState(""),[be,je]=t.useState(""),[ve,ke]=t.useState(!1),[Ne,fe]=t.useState({customerName:"",customerPhone:"",customerEmail:"",addressLine1:"",addressLine2:"",landmark:"",city:"",state:"",pincode:"",country:"",alternatePhone:"",deliveryNote:"",productName:""}),[we,Se]=t.useState(null),[_e,Ce]=t.useState(new Set),[Pe,Ie]=t.useState(!1),[Ae,De]=t.useState(!1),[Le,Oe]=t.useState(null),Ue=e=>{Ce(t=>{const r=new Set(t);return r.has(e)?r.delete(e):r.add(e),r})},$e=e=>{Y(e),e.length>0?localStorage.setItem("orders-processing-errors",JSON.stringify(e)):localStorage.removeItem("orders-processing-errors")},[Me,Te]=t.useState(1),[Ee]=t.useState(50),{user:qe}=n();i();const Fe=(null==qe?void 0:qe.role)||"admin",Re=e=>{const t=e.replace(/\D/g,"");return/^(?:\+?91)?[6-9]\d{9}$/.test(t)&&t.length>=10&&t.length<=13},ze=e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),Ve=(e,t)=>{if(t&&6===t.length)return void(async e=>{if(6===e.length){Ie(!0);try{const t=await fetch(`https://api.postalpincode.in/pincode/${e}`),r=await t.json();if(r&&r[0]&&"Success"===r[0].Status&&r[0].PostOffice&&r[0].PostOffice.length>0){const e=r[0].PostOffice[0];let t="";e.Name&&e.Name!==e.District?t=e.Name:e.Block&&e.Block!==e.District?t=e.Block:e.Division&&e.Division!==e.District&&(t=e.Division),ue(r=>({...r,city:e.District||r.city,state:e.State||r.state,country:"India",addressLine1:t||r.addressLine1}))}}catch(t){}finally{Ie(!1)}}})(t);const r={"connaught place":{city:"New Delhi",state:"Delhi",country:"India"},"marine drive":{city:"Mumbai",state:"Maharashtra",country:"India"},"mg road":{city:"Bangalore",state:"Karnataka",country:"India"},"marina beach":{city:"Chennai",state:"Tamil Nadu",country:"India"},"victoria memorial":{city:"Kolkata",state:"West Bengal",country:"India"},sabarmati:{city:"Ahmedabad",state:"Gujarat",country:"India"},charminar:{city:"Hyderabad",state:"Telangana",country:"India"},"hawa mahal":{city:"Jaipur",state:"Rajasthan",country:"India"},"koregaon park":{city:"Pune",state:"Maharashtra",country:"India"}};if(e){const t=e.toLowerCase().trim();if(r[t]){const e=r[t];ue(t=>({...t,city:e.city,state:e.state,country:e.country}))}}};t.useEffect(()=>{const e=new URLSearchParams(window.location.search),t=e.get("status"),r=e.get("date");t&&["pending","assigned","confirmed","shipped","delivered","cancelled","returned"].includes(t)&&D(t),r&&T(`Date: ${r}`),Ze(),Xe(),Ge(1,r||void 0),We()},[Fe]);const Be=async()=>{try{const e=await fetch(l("/api/orders?limit=50000&page=1"),{credentials:"include",headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});if(e.ok){const t=await e.json();if(t.orders&&Array.isArray(t.orders)){const e=t.orders.map(e=>({id:e.order_id.toString(),orderId:`ORD${e.order_id}`,customerId:`CUS${e.customer_id}`,customerName:e.customer_name||"Unknown",amount:parseFloat(e.display_amount)||0,status:e.status||"pending",date:new Date(e.order_date||e.created_at).toISOString().split("T")[0],channel:e.order_source||"Unknown",type:"Standard",customer:e.customer_name||"Unknown",paymentStatus:e.payment_status||"pending",user_id:e.user_id,order_items:e.order_items||[]})),r=e.reduce((e,t)=>"paid"===t.paymentStatus?e+(t.amount||0):e,0),a=e.filter(e=>"pending"===e.paymentStatus).length,s=(new Date).toISOString().split("T")[0],d=e.filter(e=>e.date===s).length;w(r),_(a),P(d)}}}catch(e){}};t.useEffect(()=>{Be()},[]),t.useEffect(()=>{const e=()=>{Be()};return window.addEventListener("focus",e),()=>window.removeEventListener("focus",e)},[]),t.useEffect(()=>{if(!I)return;const e=e=>{e.paymentStatus&&e.orderId?(b(t=>t.map(t=>t.id===e.orderId.toString()?{...t,paymentStatus:e.paymentStatus,...void 0!==e.newTotalAmount&&{amount:parseFloat(e.newTotalAmount)}}:t)),"paid"===e.paymentStatus?(w(t=>{const r=e.newTotalAmount||e.originalTotalAmount||0;return t+parseFloat(r)}),_(e=>Math.max(0,e-1))):"pending"===e.paymentStatus&&(w(t=>{const r=e.originalTotalAmount||0;return Math.max(0,t-parseFloat(r))}),_(e=>e+1)),setTimeout(()=>{Be()},1e3)):(Ge(),Be())},t=window.io;return t&&t.connected?(t.on("order-status-updated",e),()=>{t.off("order-status-updated",e)}):void 0},[I]);const We=async()=>{try{const e=await fetch(l("/api/orders?limit=50&page=1"),{credentials:"include"});if(e.ok){const t=await e.json();t.pagination&&t.pagination.total&&N(t.pagination.total)}}catch(e){}},Je=async e=>{try{const t=await fetch(l(`/api/customers/${e.replace("CUS","")}`),{credentials:"include"});if(t.ok){const e=await t.json();Oe(e),De(!0)}else alert("Failed to load customer details")}catch(t){alert("Failed to load customer details")}},Ge=async(e=Me,t)=>{try{const r=new URLSearchParams({limit:"50",page:e.toString()});M&&r.append("search",M),A&&"all"!==A&&r.append("status",A);const a=t||new URLSearchParams(window.location.search).get("date");a&&r.append("date",a);const s=await fetch(`/api/orders?${r.toString()}`,{credentials:"include"});if(s.ok){const e=await s.json();if(e.orders&&Array.isArray(e.orders)){const t=e.orders.map(e=>(18437===e.order_id||e.order_id,{id:e.order_id.toString(),orderId:`ORD${e.order_id}`,customerId:`CUS${e.customer_id}`,customerName:e.customer_name||"Unknown",amount:parseFloat(e.display_amount)||0,status:e.status||"pending",date:new Date(e.order_date||e.created_at).toISOString().split("T")[0],channel:e.order_source||"Unknown",type:"Standard",customer:e.customer_name||"Unknown",paymentStatus:e.payment_status||"pending",user_id:e.user_id,order_items:e.order_items||[]}));b(t),e.pagination&&e.pagination.total&&N(e.pagination.total)}else b([])}else await s.text()}catch(r){b([])}finally{v(!1)}},He=y,Ke=Math.ceil(k/Ee),Qe=y;t.useEffect(()=>{Te(1);const e=new URLSearchParams(window.location.search).get("date");Ge(1,e||void 0)},[M,A]);const Ye=t.useMemo(()=>[...Qe].sort((e,t)=>{const r=e[L],a=t[L];if("orderId"===L){const e="string"==typeof r?r:String(r??""),t="string"==typeof a?a:String(a??""),s=parseInt(e.replace("ORD",""))||0,d=parseInt(t.replace("ORD",""))||0;return"asc"===U?s-d:d-s}return"string"==typeof r&&"string"==typeof a?"asc"===U?r.localeCompare(a):a.localeCompare(r):"number"==typeof r&&"number"==typeof a?"asc"===U?r-a:a-r:0}),[Qe,L,U]),Ze=async()=>{if("admin"===Fe)try{const e=await fetch(l("/api/users"),{credentials:"include"});if(e.ok){const t=await e.json();V(t.users.filter(e=>"admin"!==e.role))}}catch(e){}},Xe=async()=>{try{const e=await fetch(l("/api/inventory"),{credentials:"include"});if(e.ok){const t=await e.json();he(t.products||[])}}catch(e){}},et=e=>{R(e),q(!0)},tt=e=>{var t;if("pending"===e.paymentStatus&&"cancelled"!==e.status)return void alert("Cannot return unpaid orders. Please ensure the order is paid before processing a return.");R(e);const r=(null==(t=e.order_items)?void 0:t.map(e=>({product_id:e.product_id,quantity:e.quantity,unit_price:e.price_per_unit,total_amount:e.total_price})))||[];K({reason:"",returnItems:r}),G(!0)},rt=async(e,t)=>{const r=y.find(t=>t.id===e);if("delivered"===t&&r&&"paid"!==r.paymentStatus)alert("Cannot mark order as delivered until payment is received. Please mark the order as paid first.");else if("cancelled"===t&&r&&"paid"!==r.paymentStatus)alert("Cannot cancel order until payment is received. Please mark the order as paid first.");else if("assigned"===t&&r&&"assigned"!==r.status)alert('Please use the "Assign" button to assign orders to employees. This will open the employee selection modal.');else try{const r="admin"===Fe?`/api/orders/${e}/status`:`/api/employee/orders/${e}/status`,a="admin"===Fe?"PATCH":"PUT",s=await fetch(r,{method:a,headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({status:t})});if(s.ok)b(r=>r.map(r=>r.id===e?{...r,status:t}:r));else{const e=await s.json();alert(e.message)}}catch(a){alert("Network error occurred")}},at=async(e,t,r="cash",a,s)=>{oe(e);try{const d=await fetch(`/api/orders/${e}/payment`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({status:t,paymentMethod:r,amount:a,pricePerUnit:s})});if(d.ok){const r=await d.json();b(a=>a.map(a=>{var d;if(a.id===e.toString()){const e={...a,paymentStatus:t,..."paid"===t&&"cancelled"!==a.status&&{status:"confirmed"},...void 0!==s&&{order_items:null==(d=a.order_items)?void 0:d.map(e=>({...e,price_per_unit:s}))},...void 0!==r.newTotalAmount&&{amount:parseFloat(r.newTotalAmount)}};return"paid"===t&&"cancelled"!==a.status||"paid"===t&&a.status,e}return a})),"paid"===t?(w(e=>{const t=r.newTotalAmount||a||0;return e+parseFloat(t)}),_(e=>Math.max(0,e-1))):"pending"===t&&(w(e=>{const t=a||0;return Math.max(0,e-t)}),_(e=>e+1)),r.invoiceCreationFailed&&alert(`Payment updated successfully, but invoice creation failed: ${r.invoiceCreationError}\n\nPlease set up your billing details in Settings to enable automatic invoice creation.`)}else{const e=await d.json();alert(`Failed to update payment: ${e.message}`)}}catch(d){alert("Failed to update payment status")}finally{oe(null)}},st=(e,t)=>{if("paid"===t){ae(e);const t=e.order_items&&e.order_items.length>0?e.order_items[0].price_per_unit:0;de({pricePerUnit:t,paymentMethod:"cash"}),te(!0)}else at(parseInt(e.id,10),t)};return j?e.jsxs(s,{children:[e.jsx("h1",{className:"text-3xl font-bold heading-gradient mb-6",children:"Orders"}),e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"text-lg text-slate-300",children:"Loading orders..."})})]}):e.jsxs(s,{children:[e.jsx("h1",{className:"text-3xl font-bold heading-gradient mb-6",children:"Orders"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-slate-800/50 p-6 rounded-lg",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-300 mb-3",children:"Total Orders"}),e.jsx("p",{className:"text-4xl font-bold text-white",children:k.toLocaleString()})]}),e.jsxs("div",{className:"bg-slate-800/50 p-6 rounded-lg",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-300 mb-3",children:"Total Revenue"}),e.jsx("p",{className:"text-4xl font-bold text-white",children:h(f)})]}),e.jsxs("div",{className:"bg-slate-800/50 p-6 rounded-lg",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-300 mb-3",children:"Pending Orders"}),e.jsx("p",{className:"text-4xl font-bold text-white",children:S.toLocaleString()})]}),e.jsxs("div",{className:"bg-slate-800/50 p-6 rounded-lg",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-300 mb-3",children:"New Orders Today"}),e.jsx("p",{className:"text-4xl font-bold text-white",children:C.toLocaleString()})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end items-center mb-6 space-y-4 sm:space-y-0 sm:space-x-4",children:[e.jsx("input",{type:"text",placeholder:"Search by customer name, customer ID, or order ID (e.g., 12998)",className:"p-2 border border-gray-300 dark:border-gray-700 rounded-md w-full sm:w-[31rem] bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:M,onChange:e=>T(e.target.value)}),e.jsxs("div",{className:"flex space-x-2 w-full sm:w-auto",children:[e.jsxs("select",{className:"p-2 border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:A,onChange:e=>D(e.target.value),children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"assigned",children:"Assigned"}),e.jsx("option",{value:"confirmed",children:"Confirmed"}),e.jsx("option",{value:"shipped",children:"Shipped"}),e.jsx("option",{value:"delivered",children:"Delivered"}),e.jsx("option",{value:"cancelled",children:"Cancelled"}),e.jsx("option",{value:"returned",children:"Returned"})]}),e.jsxs("select",{className:"p-2 border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:L,onChange:e=>O(e.target.value),children:[e.jsx("option",{value:"orderId",children:"Sort by Order ID"}),e.jsx("option",{value:"date",children:"Sort by Date"}),e.jsx("option",{value:"amount",children:"Sort by Amount"}),e.jsx("option",{value:"status",children:"Sort by Status"})]}),e.jsx("button",{onClick:()=>$("asc"===U?"desc":"asc"),className:"p-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors",children:"asc"===U?"Asc":"Desc"})]})]}),"admin"===Fe&&e.jsxs("div",{className:"mb-6",children:[e.jsx("button",{onClick:()=>me(!0),className:"p-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors w-full mt-4",children:"Add Order Manually"}),e.jsxs("div",{className:"flex items-center space-x-4 mt-4",children:[e.jsx(o,{onFileUpload:async e=>{const t=`upload_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;Se(t);const r=new FormData;r.append("file",e),r.append("uploadId",t);try{const e=await fetch(l("/api/orders/upload-csv"),{method:"POST",credentials:"include",body:r}),t=await e.json();if(!e.ok)throw new Error(t.message||"Upload failed");t.errorDetails&&t.errorDetails.length>0&&$e(t.errorDetails),await Ge(),await We(),t.uploadId||alert(`${t.message}\n\nCreated: ${t.created} orders\nErrors: ${t.errors}`)}catch(a){throw new Error(a instanceof Error?a.message:"Network error")}p(0,(e.name,e.size))},buttonLabel:"Upload CSV",showProgress:!0,uploadId:we||void 0,onProcessingErrors:$e}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("h3",{className:"text-sm font-semibold text-blue-800 dark:text-blue-200 mr-2",children:"CSV Upload Format:"}),e.jsxs("div",{className:"relative group inline-block",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"w-4 h-4 text-blue-600 dark:text-blue-300 cursor-pointer",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z"})}),e.jsxs("div",{className:"absolute left-1/2 transform -translate-x-1/2 top-full mt-2 w-80 p-3 rounded-lg shadow-lg bg-gray-800 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-300 z-50 pointer-events-none",children:[e.jsx("div",{className:"mb-1",children:"Your CSV file SHOULD include these columns (in any order):"}),e.jsx("div",{className:"font-mono text-[10px]",children:"customer_name, customer_phone, customer_email, address_line1, city, state, pincode, state_code, product_name, quantity, unit_price, order_source"}),e.jsxs("div",{className:"mt-2",children:[e.jsx("strong",{children:"Example:"})," John Doe, +1234567890, john@email.com, 123 Main St, Mumbai, Maharashtra, 400001, 27, Product A, 2, 25.50, Phone"]}),e.jsxs("div",{className:"mt-1",children:[e.jsx("strong",{children:"Note:"})," state_code is required for proper GST calculation (e.g., 27 for Maharashtra, 19 for West Bengal)"]}),e.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 w-3 h-3 bg-gray-800 rotate-45"})]})]})]}),e.jsx(c,{onDownloadCSV:()=>{const e=[["Order ID","Customer ID","Customer Name","Channel","Status","Payment Status","Unit Price","Amount","Date"],...He.map(e=>[e.orderId,e.customerId,e.customerName,e.channel,e.status,e.paymentStatus||"pending",e.order_items&&e.order_items.length>0?e.order_items.map(e=>`${h(e.price_per_unit)} (${e.quantity}x)`).join("; "):"N/A",e.amount,e.date])].map(e=>e.map(e=>`"${e}"`).join(",")).join("\n"),t=new Blob([e],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a"),a=URL.createObjectURL(t);r.setAttribute("href",a),r.setAttribute("download",`orders_${(new Date).toISOString().split("T")[0]}.csv`),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r),p(0,He.length)},onDownloadExcel:()=>{const e=He.map(e=>[e.orderId,e.customerId,e.customerName,e.channel,e.status,e.paymentStatus||"pending",e.order_items&&e.order_items.length>0?e.order_items.map(e=>`${h(e.price_per_unit)} (${e.quantity}x)`).join("; "):"N/A",e.amount,e.date]),t=m.aoa_to_sheet([["Order ID","Customer ID","Customer Name","Channel","Status","Payment Status","Unit Price","Amount","Date"],...e]),r=m.book_new();m.book_append_sheet(r,t,"Orders"),x(r,`orders_${(new Date).toISOString().split("T")[0]}.xlsx`),p(0,He.length)},onDownloadPDF:()=>{const e=new u;e.setFontSize(16),e.text("Orders Report",14,15),e.setFontSize(10),e.text(`Generated on: ${(new Date).toLocaleDateString()}`,14,25);const t=He.map(e=>[e.orderId,e.customerId,e.customerName,e.channel,e.status,e.paymentStatus||"pending",e.order_items&&e.order_items.length>0?e.order_items.map(e=>`${h(e.price_per_unit)} (${e.quantity}x)`).join("; "):"N/A",h(e.amount),e.date]);g(e,{head:[["Order ID","Customer ID","Customer Name","Channel","Status","Payment Status","Unit Price","Amount","Date"]],body:t,startY:35,styles:{fontSize:8},headStyles:{fillColor:[66,139,202]}}),e.save(`orders_${(new Date).toISOString().split("T")[0]}.pdf`),p(0,He.length)}}),Q.length>0&&e.jsxs("button",{onClick:()=>X(!0),className:"px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 transition-colors flex items-center space-x-2",title:"View processing errors",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),e.jsxs("span",{children:["Processing Errors (",Q.length,")"]})]})]})]}),e.jsx("div",{className:"hidden lg:block overflow-x-auto bg-white dark:bg-gray-800 rounded-lg shadow-md",children:e.jsxs("table",{className:"w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider w-1/6",children:"Order ID"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider w-1/6",children:"Customer ID"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider w-1/4",children:"Customer Name"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider w-1/6",children:"Channel"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider w-1/6",children:"Type"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider w-1/12",children:"View More"})]})}),e.jsx("tbody",{className:"bg-light-pink-100 dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:0===Ye.length?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-4 text-center text-gray-500 dark:text-gray-400",children:j?"Loading orders...":"admin"===Fe?"No orders found. Upload a CSV file or create orders manually.":"No orders assigned to you yet. Contact your admin to assign orders."})}):Ye.map(t=>e.jsxs(a.Fragment,{children:[e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white",children:t.orderId}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:t.customerId}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:t.customerName}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:t.channel}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:t.type}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsx("button",{onClick:()=>Ue(t.id),className:"text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-200 text-sm font-medium px-3 py-1 rounded border border-blue-300 hover:bg-blue-50 dark:hover:bg-blue-900 transition-colors",children:_e.has(t.id)?"View Less":"View More"})})]}),_e.has(t.id)&&e.jsx("tr",{className:"bg-gray-50 dark:bg-gray-700 relative z-10",children:e.jsxs("td",{colSpan:6,className:"px-6 py-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Order Status"}),e.jsx("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full "+("delivered"===t.status?"bg-green-100 text-green-800":"shipped"===t.status?"bg-blue-100 text-blue-800":"confirmed"===t.status?"bg-purple-100 text-purple-800":"assigned"===t.status?"bg-indigo-100 text-indigo-800":"pending"===t.status?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:t.status})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Payment"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full "+("paid"===t.paymentStatus?"bg-green-100 text-green-800":"failed"===t.paymentStatus?"bg-red-100 text-red-800":"refunded"===t.paymentStatus?"bg-gray-100 text-gray-800":"bg-yellow-100 text-yellow-800"),children:t.paymentStatus||"pending"}),e.jsxs("div",{className:"flex space-x-1 relative z-20",children:[e.jsx("button",{onClick:()=>st(t,"paid"),disabled:"paid"===t.paymentStatus,className:"px-2 py-1 text-xs rounded relative z-20 "+("paid"===t.paymentStatus?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-green-500 text-white hover:bg-green-600"),children:"Mark Paid"}),e.jsx("button",{onClick:()=>st(t,"pending"),disabled:"pending"===t.paymentStatus||"paid"===t.paymentStatus,className:"px-2 py-1 text-xs rounded relative z-20 "+("pending"===t.paymentStatus||"paid"===t.paymentStatus?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-yellow-500 text-white hover:bg-yellow-600"),children:"Mark Pending"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Unit Price"}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:t.order_items&&t.order_items.length>0?e.jsx("div",{className:"space-y-1",children:t.order_items.map((r,a)=>e.jsxs("div",{className:"text-xs",children:[h(r.price_per_unit)," (",r.quantity,"x)"]},`${t.id}-item-${a}-${r.product_id}`))}):"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Amount"}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:le===parseInt(t.id,10)?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-500 mr-2"}),e.jsx("span",{className:"text-blue-500",children:"Updating..."})]}):h(t.amount)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Date"}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:t.date})]})]}),t.order_items&&t.order_items.length>0&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-600",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-2",children:"Products Ordered"}),e.jsx("div",{className:"space-y-2",children:t.order_items.map((r,a)=>e.jsx("div",{className:"bg-gray-50 dark:bg-gray-600 p-3 rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Product:"}),e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:r.product_name||"Unknown Product"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"SKU:"}),e.jsx("div",{className:"font-mono text-gray-900 dark:text-white",children:r.sku||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Qty × Price:"}),e.jsxs("div",{className:"text-gray-900 dark:text-white",children:[r.quantity," × ",h(r.price_per_unit)," = ",h(r.total_price)]})]})]})},`${t.id}-product-${a}-${r.product_id}`))})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-600",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400",children:"Actions"}),e.jsx("button",{onClick:()=>Je(t.customerId),className:"text-xs px-3 py-1 bg-indigo-500 text-white rounded hover:bg-indigo-600 transition-colors",children:"More Customer Details"})]}),"admin"===Fe?e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs("select",{value:t.status,onChange:e=>rt(t.id,e.target.value),disabled:"delivered"===t.status||"cancelled"===t.status||"returned"===t.status,className:"text-sm border border-gray-300 dark:border-gray-600 rounded px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white "+("delivered"===t.status||"cancelled"===t.status?"opacity-50 cursor-not-allowed":""),children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"assigned",children:"Assigned"}),e.jsx("option",{value:"confirmed",children:"Confirmed"}),e.jsx("option",{value:"shipped",children:"Shipped"}),e.jsx("option",{value:"delivered",children:"Delivered"}),e.jsx("option",{value:"cancelled",children:"Cancelled"}),e.jsx("option",{value:"returned",children:"Returned"})]}),e.jsx("button",{onClick:()=>et(t),disabled:"confirmed"!==t.status||!!t.user_id,className:"text-sm px-4 py-2 rounded border "+("confirmed"!==t.status||t.user_id?"text-gray-400 cursor-not-allowed border-gray-300":"text-green-600 hover:text-green-900 dark:text-green-400 dark:hover:text-green-200 border-green-300 hover:bg-green-50 dark:hover:bg-green-900"),title:"confirmed"!==t.status?"Can only assign confirmed orders":t.user_id?"Order already assigned":"",children:"confirmed"!==t.status||t.user_id?"Assigned":"Assign"}),e.jsx("button",{onClick:()=>tt(t),disabled:!["confirmed","delivered","assigned","shipped","cancelled"].includes(t.status)||"pending"===t.paymentStatus&&"cancelled"!==t.status,className:"text-sm px-4 py-2 rounded border ml-2 "+(!["confirmed","delivered","assigned","shipped","cancelled"].includes(t.status)||"pending"===t.paymentStatus&&"cancelled"!==t.status?"text-gray-400 cursor-not-allowed border-gray-300":"text-orange-600 hover:text-orange-900 dark:text-orange-400 dark:hover:text-orange-200 border-orange-300 hover:bg-orange-50 dark:hover:bg-orange-900"),title:"pending"===t.paymentStatus&&"cancelled"!==t.status?"Cannot return unpaid orders":"cancelled"===t.status?"Can return cancelled orders":"",children:"Returned"})]}):e.jsxs("select",{value:t.status,onChange:e=>rt(t.id,e.target.value),disabled:"delivered"===t.status||"cancelled"===t.status||"returned"===t.status,className:"text-sm border border-gray-300 dark:border-gray-600 rounded px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white "+("delivered"===t.status||"cancelled"===t.status?"opacity-50 cursor-not-allowed":""),children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"assigned",children:"Assigned"}),e.jsx("option",{value:"confirmed",children:"Confirmed"}),e.jsx("option",{value:"shipped",children:"Shipped"}),e.jsx("option",{value:"delivered",children:"Delivered"}),e.jsx("option",{value:"cancelled",children:"Cancelled"}),e.jsx("option",{value:"returned",children:"Returned"})]})]})]})})]},t.id))})]})}),Ke>1&&e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-700 dark:text-gray-300",children:["Showing ",(Me-1)*Ee+1," to ",Math.min(Me*Ee,k)," of ",k," results"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>{const e=Math.max(Me-1,1);Te(e),Ge(e)},disabled:1===Me,className:"px-3 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),e.jsxs("span",{className:"px-3 py-1 text-sm text-gray-700 dark:text-gray-300",children:["Page ",Me," of ",Ke]}),e.jsx("button",{onClick:()=>{const e=Math.min(Me+1,Ke);Te(e),Ge(e)},disabled:Me===Ke,className:"px-3 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})]}),e.jsx("div",{className:"lg:hidden grid gap-4",children:0===Ye.length?e.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400 bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:j?"Loading orders...":"admin"===Fe?"No orders found. Upload a CSV file or create orders manually.":"No orders assigned to you yet. Contact your admin to assign orders."}):Ye.map(t=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md border border-gray-200 dark:border-gray-700 p-4 hover:shadow-lg transition-shadow",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:t.orderId}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:t.customerName})]}),e.jsx("button",{onClick:()=>Ue(t.id),className:"text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-200 text-sm font-medium px-3 py-1 rounded border border-blue-300 hover:bg-blue-50 dark:hover:bg-blue-900 transition-colors",children:_e.has(t.id)?"View Less":"View More"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Customer ID"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t.customerId})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Channel"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t.channel})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Type"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t.type})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Date"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t.date})]})]}),_e.has(t.id)&&e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-600 pt-4 mt-4",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Order Status"}),e.jsx("span",{className:"px-2 py-1 text-xs font-semibold rounded-full "+("delivered"===t.status?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"shipped"===t.status?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":"confirmed"===t.status?"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200":"assigned"===t.status?"bg-indigo-100 text-indigo-800 dark:bg-indigo-900 dark:text-indigo-200":"pending"===t.status?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"),children:t.status})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-2",children:"Payment Status"}),e.jsx("div",{className:"flex items-center space-x-2 mb-2",children:e.jsx("span",{className:"px-2 py-1 text-xs font-semibold rounded-full "+("paid"===t.paymentStatus?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"failed"===t.paymentStatus?"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200":"refunded"===t.paymentStatus?"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200":"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200"),children:t.paymentStatus||"pending"})}),e.jsxs("div",{className:"flex space-x-2 relative z-20",children:[e.jsx("button",{onClick:()=>st(t,"paid"),disabled:"paid"===t.paymentStatus,className:"px-3 py-1 text-xs rounded relative z-20 "+("paid"===t.paymentStatus?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-green-500 text-white hover:bg-green-600"),children:"Mark Paid"}),e.jsx("button",{onClick:()=>st(t,"pending"),disabled:"pending"===t.paymentStatus||"paid"===t.paymentStatus,className:"px-3 py-1 text-xs rounded relative z-20 "+("pending"===t.paymentStatus||"paid"===t.paymentStatus?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-yellow-500 text-white hover:bg-yellow-600"),children:"Mark Pending"})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Unit Price"}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:t.order_items&&t.order_items.length>0?e.jsx("div",{className:"space-y-1",children:t.order_items.map((r,a)=>e.jsxs("div",{className:"text-xs",children:[h(r.price_per_unit)," (",r.quantity,"x)"]},`${t.id}-mobile-item-${a}-${r.product_id}`))}):"N/A"})]}),e.jsxs("div",{className:"mb-3 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Total Amount"}),e.jsx("div",{className:"text-xl font-bold text-gray-900 dark:text-white",children:le===parseInt(t.id,10)?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-500 mr-2"}),e.jsx("span",{className:"text-sm text-blue-500",children:"Updating..."})]}):h(t.amount)})]}),t.order_items&&t.order_items.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-2",children:"Products Ordered"}),e.jsx("div",{className:"space-y-2",children:t.order_items.map((r,a)=>e.jsx("div",{className:"bg-gray-50 dark:bg-gray-600 p-3 rounded-lg",children:e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Product:"}),e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:r.product_name||"Unknown Product"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"SKU:"}),e.jsx("div",{className:"font-mono text-gray-900 dark:text-white",children:r.sku||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Qty × Price:"}),e.jsxs("div",{className:"text-gray-900 dark:text-white",children:[r.quantity," × ",h(r.price_per_unit)," = ",h(r.total_price)]})]})]})},`${t.id}-mobile-product-${a}-${r.product_id}`))})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Actions"}),e.jsx("button",{onClick:()=>Je(t.customerId),className:"text-xs px-3 py-1 bg-indigo-500 text-white rounded hover:bg-indigo-600 transition-colors",children:"More Customer Details"})]}),"admin"===Fe?e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsxs("select",{value:t.status,onChange:e=>rt(t.id,e.target.value),disabled:"delivered"===t.status||"cancelled"===t.status,className:"text-sm border border-gray-300 dark:border-gray-600 rounded px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white "+("delivered"===t.status||"cancelled"===t.status?"opacity-50 cursor-not-allowed":""),children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"assigned",children:"Assigned"}),e.jsx("option",{value:"confirmed",children:"Confirmed"}),e.jsx("option",{value:"shipped",children:"Shipped"}),e.jsx("option",{value:"delivered",children:"Delivered"}),e.jsx("option",{value:"cancelled",children:"Cancelled"}),e.jsx("option",{value:"returned",children:"Returned"})]}),e.jsx("button",{onClick:()=>et(t),disabled:"confirmed"!==t.status||!!t.user_id,className:"text-sm px-4 py-2 rounded border "+("confirmed"!==t.status||t.user_id?"text-gray-400 cursor-not-allowed border-gray-300":"text-green-600 hover:text-green-900 dark:text-green-400 dark:hover:text-green-200 border-green-300 hover:bg-green-50 dark:hover:bg-green-900"),title:"confirmed"!==t.status?"Can only assign confirmed orders":t.user_id?"Order already assigned":"",children:"confirmed"!==t.status||t.user_id?"Assigned":"Assign"}),e.jsx("button",{onClick:()=>tt(t),disabled:!["confirmed","delivered","assigned","shipped","cancelled"].includes(t.status)||"pending"===t.paymentStatus&&"cancelled"!==t.status,className:"text-sm px-4 py-2 rounded border ml-2 "+(!["confirmed","delivered","assigned","shipped","cancelled"].includes(t.status)||"pending"===t.paymentStatus&&"cancelled"!==t.status?"text-gray-400 cursor-not-allowed border-gray-300":"text-orange-600 hover:text-orange-900 dark:text-orange-400 dark:hover:text-orange-200 border-orange-300 hover:bg-orange-50 dark:hover:bg-orange-900"),title:"pending"===t.paymentStatus&&"cancelled"!==t.status?"Cannot return unpaid orders":"cancelled"===t.status?"Can return cancelled orders":"",children:"Returned"})]}):e.jsxs("select",{value:t.status,onChange:e=>rt(t.id,e.target.value),disabled:"delivered"===t.status||"cancelled"===t.status,className:"text-sm border border-gray-300 dark:border-gray-600 rounded px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white w-full "+("delivered"===t.status||"cancelled"===t.status?"opacity-50 cursor-not-allowed":""),children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"assigned",children:"Assigned"}),e.jsx("option",{value:"confirmed",children:"Confirmed"}),e.jsx("option",{value:"shipped",children:"Shipped"}),e.jsx("option",{value:"delivered",children:"Delivered"}),e.jsx("option",{value:"cancelled",children:"Cancelled"}),e.jsx("option",{value:"returned",children:"Returned"})]})]})]})]},t.id))}),E&&F&&r.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-[9999] p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-md w-full mx-4",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:["Assign Order #",F.orderId]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Assign to Employee:"}),e.jsxs("select",{value:B.userId,onChange:e=>W({...B,userId:e.target.value}),className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[e.jsx("option",{value:"",children:"Select Employee"}),z.map(t=>e.jsxs("option",{value:t.user_id,children:[t.username," (",t.role,")"]},`employee-${t.user_id}`))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Delivery Notes:"}),e.jsx("textarea",{value:B.deliveryNotes,onChange:e=>W({...B,deliveryNotes:e.target.value}),placeholder:"Special instructions for delivery...",className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",rows:3})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-6",children:[e.jsx("button",{onClick:()=>q(!1),className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:"Cancel"}),e.jsx("button",{onClick:async()=>{if(F&&B.userId)try{(await fetch(l("/api/orders/assign"),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({orderId:F.id,userId:B.userId,deliveryNotes:B.deliveryNotes})})).ok?(b(e=>e.map(e=>e.id===F.id?{...e,user_id:parseInt(B.userId),status:"assigned"}:e)),alert("Order assigned successfully!"),q(!1),W({userId:"",deliveryNotes:""}),R(null)):alert("Failed to assign order")}catch(e){alert("Failed to assign order")}},disabled:!B.userId,className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50",children:"Assign Order"})]})]})}),document.body),ce&&r.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-[9999] p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Add New Order"}),e.jsx("button",{onClick:()=>me(!1),className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Customer Name:"}),e.jsx("input",{type:"text",placeholder:"Customer Name",name:"customer_name",className:"w-full p-2 border rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white "+(Ne.customerName?"border-red-500":"border-gray-300 dark:border-gray-600"),value:xe.customerName,onChange:e=>ue({...xe,customerName:e.target.value})}),Ne.customerName&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:Ne.customerName})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Customer Phone:"}),e.jsx("input",{type:"tel",placeholder:"Customer Phone",name:"customer_phone",pattern:"[6-9][0-9]{9}",title:"Please enter a valid 10-digit Indian phone number",className:"w-full p-2 border rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white "+(Ne.customerPhone?"border-red-500":"border-gray-300 dark:border-gray-600"),value:xe.customerPhone,onChange:e=>{return t=e.target.value,ue({...xe,customerPhone:t}),void(t.trim()&&!Re(t)?fe({...Ne,customerPhone:"Please enter a valid Indian phone number (10-13 digits)"}):fe({...Ne,customerPhone:""}));var t}}),Ne.customerPhone&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:Ne.customerPhone})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Customer Email:"}),e.jsx("input",{type:"email",placeholder:"Customer Email",name:"customer_email",className:"w-full p-2 border rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white "+(Ne.customerEmail?"border-red-500":"border-gray-300 dark:border-gray-600"),value:xe.customerEmail,onChange:e=>{return t=e.target.value,ue({...xe,customerEmail:t}),void(t.trim()&&!ze(t)?fe({...Ne,customerEmail:"Please enter a valid email address"}):fe({...Ne,customerEmail:""}));var t}}),Ne.customerEmail&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:Ne.customerEmail})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-600 pt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Address Details"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Address Line 1:"}),e.jsx("input",{type:"text",placeholder:"Address Line 1 *",name:"address_line1",className:"w-full p-2 border rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white "+(Ne.addressLine1?"border-red-500":"border-gray-300 dark:border-gray-600"),value:xe.addressLine1,onChange:e=>ue({...xe,addressLine1:e.target.value})}),Ne.addressLine1&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:Ne.addressLine1})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Address Line 2 (Optional):"}),e.jsx("input",{type:"text",placeholder:"Address Line 2 (Optional)",name:"address_line2",className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:xe.addressLine2,onChange:e=>ue({...xe,addressLine2:e.target.value})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Landmark:"}),e.jsx("input",{type:"text",placeholder:"Landmark",name:"landmark",className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:xe.landmark,onChange:e=>{const t=e.target.value;ue({...xe,landmark:t}),Ve(t,xe.pincode)}})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"City:"}),e.jsx("input",{type:"text",placeholder:"City *",name:"city",className:"w-full p-2 border rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white "+(Ne.city?"border-red-500":"border-gray-300 dark:border-gray-600"),value:xe.city,onChange:e=>ue({...xe,city:e.target.value})}),Ne.city&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:Ne.city})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"State:"}),e.jsx("input",{type:"text",placeholder:"State *",name:"state",className:"w-full p-2 border rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white "+(Ne.state?"border-red-500":"border-gray-300 dark:border-gray-600"),value:xe.state,onChange:e=>ue({...xe,state:e.target.value})}),Ne.state&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:Ne.state})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Pincode:"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"Pincode *",name:"pincode",className:"w-full p-2 border rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white "+(Ne.pincode?"border-red-500":"border-gray-300 dark:border-gray-600"),value:xe.pincode,onChange:e=>{const t=e.target.value;ue({...xe,pincode:t}),Ve(xe.landmark,t)}}),Pe&&e.jsx("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2",children:e.jsx("div",{className:"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"})})]}),Ne.pincode&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:Ne.pincode})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Country:"}),e.jsx("input",{type:"text",placeholder:"Country",name:"country",className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:xe.country,onChange:e=>ue({...xe,country:e.target.value})})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Alternate Phone (Optional):"}),e.jsx("input",{type:"tel",placeholder:"Alternate Phone (Optional)",name:"alternate_phone",className:"w-full p-2 border rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white "+(Ne.alternatePhone?"border-red-500":"border-gray-300 dark:border-gray-600"),value:xe.alternatePhone,onChange:e=>ue({...xe,alternatePhone:e.target.value})}),Ne.alternatePhone&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:Ne.alternatePhone})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Delivery Note (Optional):"}),e.jsx("textarea",{placeholder:"Delivery Note (Optional)",name:"delivery_note",className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",rows:2,value:xe.deliveryNote,onChange:e=>ue({...xe,deliveryNote:e.target.value})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Customer State Code (Optional):"}),e.jsx("input",{type:"text",placeholder:"Customer State Code (Optional)",name:"state_code",maxLength:2,className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:xe.state_code,onChange:e=>ue({...xe,state_code:e.target.value})}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"2-digit state code (e.g., 19 for West Bengal)"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Customer GST Number (Optional):"}),e.jsx("input",{type:"text",placeholder:"Customer GST Number (Optional)",name:"gst_number",maxLength:15,className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:xe.gst_number,onChange:e=>ue({...xe,gst_number:e.target.value})}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"15-character GST number (e.g., 22AAAAA0000A1Z5)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Product Selection:"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1",children:"Select from dropdown:"}),e.jsxs("select",{name:"product_selection",className:"w-full p-2 border rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white "+(Ne.productName?"border-red-500":"border-gray-300 dark:border-gray-600"),value:xe.productId,onChange:e=>(e=>{if(!e)return ue(e=>({...e,productId:"",productName:"",unitPrice:0})),ye(""),void je("");const t=ge.find(t=>("string"==typeof t.product_id?parseInt(t.product_id):t.product_id)===parseInt(e)||"string"==typeof t.product_id&&t.product_id===e);t&&(ue(r=>({...r,productId:e,productName:t.product_name,unitPrice:t.unit_price})),ye(e),je(""))})(e.target.value),children:[e.jsx("option",{value:"",children:"Select a product from inventory"}),ge.map(t=>e.jsxs("option",{value:t.product_id,children:[t.product_name," (ID: ",t.product_id,")"]},t.product_id))]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1",children:"Or enter Product ID manually:"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",placeholder:"Enter Product ID (e.g., 1049112)",className:"w-full p-2 border rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white "+(be?"border-red-500":"border-gray-300 dark:border-gray-600"),value:pe,onChange:e=>(async e=>{if(ye(e),je(""),!e.trim())return void ue(e=>({...e,productId:"",productName:"",unitPrice:0}));const t=parseInt(e);if(isNaN(t))return je("Please enter a valid product ID (number)"),void ue(e=>({...e,productId:"",productName:"",unitPrice:0}));ke(!0);const r=ge.find(e=>("string"==typeof e.product_id?parseInt(e.product_id):e.product_id)===t||"string"==typeof e.product_id&&e.product_id===t.toString());r?(ue(t=>({...t,productId:e,productName:r.product_name,unitPrice:r.unit_price})),je("")):(je("Product ID not found in inventory"),ue(e=>({...e,productId:"",productName:"",unitPrice:0}))),ke(!1)})(e.target.value),disabled:ve}),ve&&e.jsx("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2",children:e.jsx("div",{className:"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"})})]}),be&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:be})]}),xe.productName&&e.jsxs("div",{className:"p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-md",children:[e.jsxs("p",{className:"text-sm text-green-800 dark:text-green-200",children:[e.jsx("strong",{children:"Selected:"})," ",xe.productName," (ID: ",xe.productId,")"]}),e.jsxs("p",{className:"text-xs text-green-600 dark:text-green-300 mt-1",children:["Unit Price: ₹",xe.unitPrice]})]}),Ne.productName&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:Ne.productName})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Quantity:"}),e.jsx("input",{type:"number",placeholder:"Enter quantity",name:"quantity",min:"1",className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:xe.quantity,onChange:e=>ue({...xe,quantity:parseInt(e.target.value)||1})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Unit Price:"}),e.jsx("input",{type:"number",placeholder:"Enter unit price",name:"unit_price",step:"0.01",min:"0",className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:xe.unitPrice,onChange:e=>ue({...xe,unitPrice:parseFloat(e.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Order Source:"}),e.jsxs("select",{name:"order_source",className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:xe.orderSource,onChange:e=>ue({...xe,orderSource:e.target.value}),children:[e.jsx("option",{value:"Manual",children:"Manual"}),e.jsx("option",{value:"Phone",children:"Phone"}),e.jsx("option",{value:"Email",children:"Email"}),e.jsx("option",{value:"Website",children:"Website"}),e.jsx("option",{value:"WhatsApp",children:"WhatsApp"})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-6",children:[e.jsx("button",{onClick:()=>me(!1),className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:"Cancel"}),e.jsx("button",{onClick:async()=>{if((()=>{const e={customerName:"",customerPhone:"",customerEmail:"",addressLine1:"",addressLine2:"",landmark:"",city:"",state:"",pincode:"",country:"",alternatePhone:"",deliveryNote:"",productName:""};let t=!0;return xe.customerName.trim()||(e.customerName="Customer name is required",t=!1),xe.customerPhone.trim()?Re(xe.customerPhone)||(e.customerPhone="Please enter a valid Indian phone number (10-13 digits)",t=!1):(e.customerPhone="Phone number is required",t=!1),xe.customerEmail.trim()&&!ze(xe.customerEmail)&&(e.customerEmail="Please enter a valid email address",t=!1),xe.addressLine1.trim()||(e.addressLine1="Address Line 1 is required",t=!1),xe.city.trim()||(e.city="City is required",t=!1),xe.state.trim()||(e.state="State is required",t=!1),xe.pincode.trim()||(e.pincode="Pincode is required",t=!1),xe.alternatePhone.trim()&&!Re(xe.alternatePhone)&&(e.alternatePhone="Please enter a valid Indian phone number (10-13 digits)",t=!1),xe.productName.trim()||xe.productId||(e.productName="Please select a product from inventory",t=!1),fe(e),t})())try{const e=await fetch(l("/api/orders/add-manual"),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(xe)});if(e.ok){const t=await e.json(),r={id:t.order_id.toString(),orderId:`ORD${t.order_id}`,customerId:`CUS${t.customer_id}`,customerName:t.customer_name||"Unknown",amount:parseFloat(t.display_amount)||0,status:t.status||"pending",date:new Date(t.order_date||t.created_at).toISOString().split("T")[0],channel:t.order_source||"Unknown",type:"Standard",customer:t.customer_name||"Unknown",paymentStatus:t.payment_status||"pending",user_id:t.user_id,order_items:t.order_items||[{product_id:0,product_name:xe.productName,quantity:xe.quantity,price_per_unit:xe.unitPrice,total_price:xe.quantity*xe.unitPrice,sku:"SKU"}]};b(e=>[r,...e]),me(!1),ue({customerName:"",customerPhone:"",customerEmail:"",addressLine1:"",addressLine2:"",landmark:"",city:"",state:"",pincode:"",country:"India",alternatePhone:"",isVerifiedAddress:!1,deliveryNote:"",productName:"",productId:"",quantity:0,unitPrice:0,orderSource:"Manual",state_code:"",gst_number:""}),ye(""),je(""),ke(!1),fe({customerName:"",customerPhone:"",customerEmail:"",addressLine1:"",addressLine2:"",landmark:"",city:"",state:"",pincode:"",country:"",alternatePhone:"",deliveryNote:"",productName:""}),await We(),setTimeout(()=>{alert(`Order added successfully!\n\nOrder ID: ${r.orderId}\nCustomer: ${r.customerName}\nProduct: ${xe.productName}\nTotal: ${h(r.amount)}`)},100)}else{const t=await e.json();401===e.status?(alert("Session expired. Please log in again."),window.location.href="/login"):alert(`Failed to add order: ${t.message||"Unknown error"}`)}}catch(e){alert("Failed to add order: Network error")}},disabled:!xe.customerName||!xe.productName&&!xe.productId||!!be||ve,className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50",title:`Customer: ${xe.customerName||"empty"}, Product: ${xe.productName||xe.productId||"empty"}`,children:"Add Order"})]})]})}),document.body),ee&&re&&r.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-[9999] p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-md w-full mx-4",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:["Update Unit Price & Mark as Paid - Order #",re.orderId]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Unit Price:"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:se.pricePerUnit,onChange:e=>de({...se,pricePerUnit:parseFloat(e.target.value)||0}),className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"Enter unit price"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Payment Method:"}),e.jsxs("select",{value:se.paymentMethod,onChange:e=>de({...se,paymentMethod:e.target.value}),className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"card",children:"Card"}),e.jsx("option",{value:"upi",children:"UPI"}),e.jsx("option",{value:"bank_transfer",children:"Bank Transfer"}),e.jsx("option",{value:"cheque",children:"Cheque"}),e.jsx("option",{value:"other",children:"Other"})]})]}),re&&se.pricePerUnit>0&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-3 rounded-md border border-blue-200 dark:border-blue-800",children:[e.jsx("div",{className:"text-sm text-blue-800 dark:text-blue-200",children:e.jsx("strong",{children:"Preview:"})}),e.jsxs("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:["Current Total: ",h(re.amount)]}),(()=>{var t;const r=((null==(t=re.order_items)?void 0:t.reduce((e,t)=>e+t.quantity,0))||0)*se.pricePerUnit;return e.jsxs("div",{className:"text-sm font-semibold text-green-700 dark:text-green-300",children:["New Total: ",h(r)]})})()]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-6",children:[e.jsx("button",{onClick:()=>te(!1),className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:"Cancel"}),e.jsx("button",{onClick:async()=>{if(re){ie(!0);try{await at(parseInt(re.id,10),"paid",se.paymentMethod,void 0,se.pricePerUnit),setTimeout(()=>{te(!1),ae(null),de({pricePerUnit:0,paymentMethod:"cash"}),ie(!1)},800)}catch(e){ie(!1)}}},disabled:se.pricePerUnit<=0||ne,className:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 disabled:opacity-50",children:ne?"Updating...":"Mark as Paid & Update Price"})]})]})}),document.body),Z&&r.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-[9999] p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-4xl w-full mx-4 max-h-[80vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:["Processing Errors (",Q.length,")"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:()=>{Y([]),localStorage.removeItem("orders-processing-errors"),X(!1)},className:"px-3 py-1 bg-red-500 text-white text-sm rounded hover:bg-red-600 transition-colors flex items-center space-x-1",title:"Clear all errors",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),e.jsx("span",{children:"Clear"})]}),e.jsx("button",{onClick:()=>X(!1),className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",title:"Close",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 p-4 rounded-md",children:e.jsx("div",{className:"space-y-2",children:Q.map((t,r)=>e.jsxs("div",{className:"text-sm text-red-700 dark:text-red-300 break-words border-b border-red-200 dark:border-red-800 pb-2 last:border-b-0",children:[e.jsxs("span",{className:"font-medium text-red-800 dark:text-red-200",children:["#",r+1,":"]})," ",t]},`error-${r}-${t.slice(0,20)}`))})})}),e.jsx("div",{className:"flex justify-end mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsx("button",{onClick:()=>X(!1),className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors",children:"Close"})})]})}),document.body),Ae&&Le&&r.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-[9999] p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Customer Details"}),e.jsx("button",{onClick:()=>{De(!1),Oe(null)},className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Name"}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-white",children:Le.name||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Phone Number"}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-white",children:Le.phone||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Email"}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-white",children:Le.email||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"City"}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-white",children:Le.city||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"State"}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-white",children:Le.state||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Pincode"}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-white",children:Le.pincode||"N/A"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Address Line 1"}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-white",children:Le.address_line1||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Address Line 2"}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-white",children:Le.address_line2||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Landmark"}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-white",children:Le.landmark||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Delivery Note"}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-white",children:Le.delivery_note||"N/A"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"State Code"}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-white",children:Le.state_code||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"GST Number"}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-white font-mono",children:Le.gst_number||"N/A"})]})]})]}),e.jsx("div",{className:"flex justify-end mt-6",children:e.jsx("button",{onClick:()=>{De(!1),Oe(null)},className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors",children:"Close"})})]})}),document.body),J&&F&&r.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-[9999] p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:["Return Order #",F.orderId]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Return Reason:"}),e.jsx("textarea",{value:H.reason,onChange:e=>K({...H,reason:e.target.value}),placeholder:"Please specify the reason for return...",className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",rows:3,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Items to Return:"}),e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:H.returnItems.map((t,r)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-md",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:["Product ID: ",t.product_id]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Quantity: ",t.quantity," × ₹",t.unit_price," = ₹",t.total_amount]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("label",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Original Qty:"}),e.jsx("input",{type:"number",value:t.quantity,readOnly:!0,className:"w-16 px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 cursor-not-allowed"})]})]},r))})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{onClick:()=>{G(!1),K({reason:"",returnItems:[]}),R(null)},className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-600 hover:bg-gray-200 dark:hover:bg-gray-500 rounded-md transition-colors",children:"Cancel"}),e.jsx("button",{onClick:async()=>{if(F&&H.reason.trim())try{const e=await fetch(l("/api/orders/return"),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({order_id:F.id,customer_id:F.customerId.replace("CUS",""),reason:H.reason,return_items:H.returnItems})});if(e.ok)Ge(),alert("Return request submitted successfully!"),G(!1),K({reason:"",returnItems:[]}),R(null);else{const t=await e.json();alert(`Failed to submit return: ${t.message||"Unknown error"}`)}}catch(e){alert("Failed to submit return request")}},disabled:!H.reason.trim(),className:"px-4 py-2 text-sm font-medium text-white rounded-md transition-colors "+(H.reason.trim()?"bg-orange-600 hover:bg-orange-700":"bg-gray-400 cursor-not-allowed"),children:"Submit Return Request"})]})]})]})}),document.body)]})}export{y as default};
