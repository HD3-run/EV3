import{j as e}from"./framer-motion-CP1hDTrg.js";import{r as t,b as r}from"./react-vendor-CFOUl9e9.js";import{L as a}from"./Layout-Ogwp2WeB.js";import{c as s,b as d,a as n,g as i}from"./index-D8_-wRmV.js";import{F as l}from"./FileUpload-CTqf8aKo.js";import{D as o,u as c,w as m,E as x,a as u}from"./jspdf.plugin.autotable-DWM2ysb2.js";import{f as g}from"./currency-CLTscsdx.js";import"./Footer-DgPx_GeQ.js";import"./lucide-Jis9dCxC.js";const h=(e,t)=>{(new Date).toISOString()};function p(){const[p,y]=t.useState([]),[b,j]=t.useState(!0),[v,k]=t.useState(0),[N,w]=t.useState(0),[f,S]=t.useState(0),[_,C]=t.useState(0),{isConnected:P}=s(),[I,A]=t.useState("all"),[D,L]=t.useState("orderId"),[O,U]=t.useState("asc"),[$,M]=t.useState(""),[T,E]=t.useState(!1),[q,F]=t.useState(null),[R,z]=t.useState([]),[V,B]=t.useState({userId:"",deliveryNotes:""}),[W,J]=t.useState(!1),[H,G]=t.useState({reason:"",returnItems:[]}),[K,Q]=t.useState(()=>{const e=localStorage.getItem("orders-processing-errors");return e?JSON.parse(e):[]}),[Y,Z]=t.useState(!1),[X,ee]=t.useState(!1),[te,re]=t.useState(null),[ae,se]=t.useState({pricePerUnit:0,paymentMethod:"cash"}),[de,ne]=t.useState(!1),[ie,le]=t.useState(null),[oe,ce]=t.useState(!1),[me,xe]=t.useState({customerName:"",customerPhone:"",customerEmail:"",addressLine1:"",addressLine2:"",landmark:"",city:"",state:"",pincode:"",country:"India",alternatePhone:"",isVerifiedAddress:!1,deliveryNote:"",productName:"",quantity:1,unitPrice:0,orderSource:"Manual",state_code:"",gst_number:""}),[ue,ge]=t.useState({customerName:"",customerPhone:"",customerEmail:"",addressLine1:"",addressLine2:"",landmark:"",city:"",state:"",pincode:"",country:"",alternatePhone:"",deliveryNote:"",productName:""}),[he,pe]=t.useState(null),[ye,be]=t.useState(new Set),[je,ve]=t.useState(!1),[ke,Ne]=t.useState(!1),[we,fe]=t.useState(null),Se=e=>{be(t=>{const r=new Set(t);return r.has(e)?r.delete(e):r.add(e),r})},_e=e=>{Q(e),e.length>0?localStorage.setItem("orders-processing-errors",JSON.stringify(e)):localStorage.removeItem("orders-processing-errors")},[Ce,Pe]=t.useState(1),[Ie]=t.useState(50),{user:Ae}=d();n();const De=(null==Ae?void 0:Ae.role)||"admin",Le=e=>{const t=e.replace(/\D/g,"");return/^(?:\+?91)?[6-9]\d{9}$/.test(t)&&t.length>=10&&t.length<=13},Oe=e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),Ue=(e,t)=>{if(t&&6===t.length)return void(async e=>{if(6===e.length){ve(!0);try{const t=await fetch(`https://api.postalpincode.in/pincode/${e}`),r=await t.json();if(r&&r[0]&&"Success"===r[0].Status&&r[0].PostOffice&&r[0].PostOffice.length>0){const e=r[0].PostOffice[0];let t="";e.Name&&e.Name!==e.District?t=e.Name:e.Block&&e.Block!==e.District?t=e.Block:e.Division&&e.Division!==e.District&&(t=e.Division),xe(r=>({...r,city:e.District||r.city,state:e.State||r.state,country:"India",addressLine1:t||r.addressLine1}))}}catch(t){}finally{ve(!1)}}})(t);const r={"connaught place":{city:"New Delhi",state:"Delhi",country:"India"},"marine drive":{city:"Mumbai",state:"Maharashtra",country:"India"},"mg road":{city:"Bangalore",state:"Karnataka",country:"India"},"marina beach":{city:"Chennai",state:"Tamil Nadu",country:"India"},"victoria memorial":{city:"Kolkata",state:"West Bengal",country:"India"},sabarmati:{city:"Ahmedabad",state:"Gujarat",country:"India"},charminar:{city:"Hyderabad",state:"Telangana",country:"India"},"hawa mahal":{city:"Jaipur",state:"Rajasthan",country:"India"},"koregaon park":{city:"Pune",state:"Maharashtra",country:"India"}};if(e){const t=e.toLowerCase().trim();if(r[t]){const e=r[t];xe(t=>({...t,city:e.city,state:e.state,country:e.country}))}}};t.useEffect(()=>{const e=new URLSearchParams(window.location.search),t=e.get("status"),r=e.get("date");t&&["pending","assigned","confirmed","shipped","delivered","cancelled","returned"].includes(t)&&A(t),r&&M(`Date: ${r}`),Ve(),Ee(1,r||void 0),Me()},[De]);const $e=async()=>{try{const e=await fetch(i("/api/orders?limit=50000&page=1"),{credentials:"include",headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});if(e.ok){const t=await e.json();if(t.orders&&Array.isArray(t.orders)){const e=t.orders.map(e=>({id:e.order_id.toString(),orderId:`ORD${e.order_id}`,customerId:`CUS${e.customer_id}`,customerName:e.customer_name||"Unknown",amount:parseFloat(e.display_amount)||0,status:e.status||"pending",date:new Date(e.order_date||e.created_at).toISOString().split("T")[0],channel:e.order_source||"Unknown",type:"Standard",customer:e.customer_name||"Unknown",paymentStatus:e.payment_status||"pending",user_id:e.user_id,order_items:e.order_items||[]})),r=e.reduce((e,t)=>"paid"===t.paymentStatus?e+(t.amount||0):e,0),a=e.filter(e=>"pending"===e.paymentStatus).length,s=(new Date).toISOString().split("T")[0],d=e.filter(e=>e.date===s).length;w(r),S(a),C(d)}}}catch(e){}};t.useEffect(()=>{$e()},[]),t.useEffect(()=>{const e=()=>{$e()};return window.addEventListener("focus",e),()=>window.removeEventListener("focus",e)},[]),t.useEffect(()=>{if(!P)return;const e=e=>{e.paymentStatus&&e.orderId?(y(t=>t.map(t=>t.id===e.orderId.toString()?{...t,paymentStatus:e.paymentStatus,...void 0!==e.newTotalAmount&&{amount:parseFloat(e.newTotalAmount)}}:t)),"paid"===e.paymentStatus?(w(t=>{const r=e.newTotalAmount||e.originalTotalAmount||0;return t+parseFloat(r)}),S(e=>Math.max(0,e-1))):"pending"===e.paymentStatus&&(w(t=>{const r=e.originalTotalAmount||0;return Math.max(0,t-parseFloat(r))}),S(e=>e+1)),setTimeout(()=>{$e()},1e3)):(Ee(),$e())},t=window.io;return t&&t.connected?(t.on("order-status-updated",e),()=>{t.off("order-status-updated",e)}):void 0},[P]);const Me=async()=>{try{const e=await fetch(i("/api/orders?limit=50&page=1"),{credentials:"include"});if(e.ok){const t=await e.json();t.pagination&&t.pagination.total&&k(t.pagination.total)}}catch(e){}},Te=async e=>{try{const t=await fetch(i(`/api/customers/${e.replace("CUS","")}`),{credentials:"include"});if(t.ok){const e=await t.json();fe(e),Ne(!0)}else alert("Failed to load customer details")}catch(t){alert("Failed to load customer details")}},Ee=async(e=Ce,t)=>{try{const r=new URLSearchParams({limit:"50",page:e.toString()});$&&r.append("search",$),I&&"all"!==I&&r.append("status",I);const a=t||new URLSearchParams(window.location.search).get("date");a&&r.append("date",a);const s=await fetch(`/api/orders?${r.toString()}`,{credentials:"include"});if(s.ok){const e=await s.json();if(e.orders&&Array.isArray(e.orders)){const t=e.orders.map(e=>(18437===e.order_id||e.order_id,{id:e.order_id.toString(),orderId:`ORD${e.order_id}`,customerId:`CUS${e.customer_id}`,customerName:e.customer_name||"Unknown",amount:parseFloat(e.display_amount)||0,status:e.status||"pending",date:new Date(e.order_date||e.created_at).toISOString().split("T")[0],channel:e.order_source||"Unknown",type:"Standard",customer:e.customer_name||"Unknown",paymentStatus:e.payment_status||"pending",user_id:e.user_id,order_items:e.order_items||[]}));y(t),e.pagination&&e.pagination.total&&k(e.pagination.total)}else y([])}else await s.text()}catch(r){y([])}finally{j(!1)}},qe=p,Fe=Math.ceil(v/Ie),Re=p;t.useEffect(()=>{Pe(1);const e=new URLSearchParams(window.location.search).get("date");Ee(1,e||void 0)},[$,I]);const ze=t.useMemo(()=>[...Re].sort((e,t)=>{const r=e[D],a=t[D];if("orderId"===D){const e="string"==typeof r?r:String(r??""),t="string"==typeof a?a:String(a??""),s=parseInt(e.replace("ORD",""))||0,d=parseInt(t.replace("ORD",""))||0;return"asc"===O?s-d:d-s}return"string"==typeof r&&"string"==typeof a?"asc"===O?r.localeCompare(a):a.localeCompare(r):"number"==typeof r&&"number"==typeof a?"asc"===O?r-a:a-r:0}),[Re,D,O]),Ve=async()=>{if("admin"===De)try{const e=await fetch(i("/api/users"),{credentials:"include"});if(e.ok){const t=await e.json();z(t.users.filter(e=>"admin"!==e.role))}}catch(e){}},Be=e=>{F(e),E(!0)},We=e=>{var t;if("pending"===e.paymentStatus&&"cancelled"!==e.status)return void alert("Cannot return unpaid orders. Please ensure the order is paid before processing a return.");F(e);const r=(null==(t=e.order_items)?void 0:t.map(e=>({product_id:e.product_id,quantity:e.quantity,unit_price:e.price_per_unit,total_amount:e.total_price})))||[];G({reason:"",returnItems:r}),J(!0)},Je=async(e,t)=>{const r=p.find(t=>t.id===e);if("delivered"===t&&r&&"paid"!==r.paymentStatus)alert("Cannot mark order as delivered until payment is received. Please mark the order as paid first.");else if("cancelled"===t&&r&&"paid"!==r.paymentStatus)alert("Cannot cancel order until payment is received. Please mark the order as paid first.");else if("assigned"===t&&r&&"assigned"!==r.status)alert('Please use the "Assign" button to assign orders to employees. This will open the employee selection modal.');else try{const r="admin"===De?`/api/orders/${e}/status`:`/api/employee/orders/${e}/status`,a="admin"===De?"PATCH":"PUT",s=await fetch(r,{method:a,headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({status:t})});if(s.ok)y(r=>r.map(r=>r.id===e?{...r,status:t}:r));else{const e=await s.json();alert(e.message)}}catch(a){alert("Network error occurred")}},He=async(e,t,r="cash",a,s)=>{le(e);try{const d=await fetch(`/api/orders/${e}/payment`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({status:t,paymentMethod:r,amount:a,pricePerUnit:s})});if(d.ok){const r=await d.json();y(a=>a.map(a=>{var d;if(a.id===e.toString()){const e={...a,paymentStatus:t,..."paid"===t&&"cancelled"!==a.status&&{status:"confirmed"},...void 0!==s&&{order_items:null==(d=a.order_items)?void 0:d.map(e=>({...e,price_per_unit:s}))},...void 0!==r.newTotalAmount&&{amount:parseFloat(r.newTotalAmount)}};return"paid"===t&&"cancelled"!==a.status||"paid"===t&&a.status,e}return a})),"paid"===t?(w(e=>{const t=r.newTotalAmount||a||0;return e+parseFloat(t)}),S(e=>Math.max(0,e-1))):"pending"===t&&(w(e=>{const t=a||0;return Math.max(0,e-t)}),S(e=>e+1)),r.invoiceCreationFailed&&alert(`Payment updated successfully, but invoice creation failed: ${r.invoiceCreationError}\n\nPlease set up your billing details in Settings to enable automatic invoice creation.`)}else{const e=await d.json();alert(`Failed to update payment: ${e.message}`)}}catch(d){alert("Failed to update payment status")}finally{le(null)}},Ge=(e,t)=>{if("paid"===t){re(e);const t=e.order_items&&e.order_items.length>0?e.order_items[0].price_per_unit:0;se({pricePerUnit:t,paymentMethod:"cash"}),ee(!0)}else He(parseInt(e.id,10),t)};return b?e.jsxs(a,{children:[e.jsx("h1",{className:"text-3xl font-bold heading-gradient mb-6",children:"Orders"}),e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"text-lg text-slate-300",children:"Loading orders..."})})]}):e.jsxs(a,{children:[e.jsx("h1",{className:"text-3xl font-bold heading-gradient mb-6",children:"Orders"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-light-pink-100 dark:bg-gray-800 p-5 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-700 dark:text-gray-300 mb-3",children:"Total Orders"}),e.jsx("p",{className:"text-4xl font-bold text-blue-600 dark:text-blue-400",children:v.toLocaleString()})]}),e.jsxs("div",{className:"bg-light-pink-100 dark:bg-gray-800 p-5 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-700 dark:text-gray-300 mb-3",children:"Total Revenue"}),e.jsx("p",{className:"text-4xl font-bold text-green-600 dark:text-green-400",children:g(N)})]}),e.jsxs("div",{className:"bg-light-pink-100 dark:bg-gray-800 p-5 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-700 dark:text-gray-300 mb-3",children:"Pending Orders"}),e.jsx("p",{className:"text-4xl font-bold text-yellow-600 dark:text-yellow-400",children:f.toLocaleString()})]}),e.jsxs("div",{className:"bg-light-pink-100 dark:bg-gray-800 p-5 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-700 dark:text-gray-300 mb-3",children:"New Orders Today"}),e.jsx("p",{className:"text-4xl font-bold text-purple-600 dark:text-purple-400",children:_.toLocaleString()})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end items-center mb-6 space-y-4 sm:space-y-0 sm:space-x-4",children:[e.jsx("input",{type:"text",placeholder:"Search by customer, customer ID, or order ID...",className:"p-2 border border-gray-300 dark:border-gray-700 rounded-md w-full sm:w-auto bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:$,onChange:e=>M(e.target.value)}),e.jsxs("div",{className:"flex space-x-2 w-full sm:w-auto",children:[e.jsxs("select",{className:"p-2 border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:I,onChange:e=>A(e.target.value),children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"assigned",children:"Assigned"}),e.jsx("option",{value:"confirmed",children:"Confirmed"}),e.jsx("option",{value:"shipped",children:"Shipped"}),e.jsx("option",{value:"delivered",children:"Delivered"}),e.jsx("option",{value:"cancelled",children:"Cancelled"}),e.jsx("option",{value:"returned",children:"Returned"})]}),e.jsxs("select",{className:"p-2 border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:D,onChange:e=>L(e.target.value),children:[e.jsx("option",{value:"orderId",children:"Sort by Order ID"}),e.jsx("option",{value:"date",children:"Sort by Date"}),e.jsx("option",{value:"amount",children:"Sort by Amount"}),e.jsx("option",{value:"status",children:"Sort by Status"})]}),e.jsx("button",{onClick:()=>U("asc"===O?"desc":"asc"),className:"p-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors",children:"asc"===O?"Asc":"Desc"})]})]}),"admin"===De&&e.jsxs("div",{className:"mb-6",children:[e.jsx("button",{onClick:()=>ce(!0),className:"p-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors w-full mt-4",children:"Add Order Manually"}),e.jsxs("div",{className:"flex items-center space-x-4 mt-4",children:[e.jsx(l,{onFileUpload:async e=>{const t=`upload_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;pe(t);const r=new FormData;r.append("file",e),r.append("uploadId",t);try{const e=await fetch(i("/api/orders/upload-csv"),{method:"POST",credentials:"include",body:r}),t=await e.json();if(!e.ok)throw new Error(t.message||"Upload failed");t.errorDetails&&t.errorDetails.length>0&&_e(t.errorDetails),await Ee(),await Me(),t.uploadId||alert(`${t.message}\n\nCreated: ${t.created} orders\nErrors: ${t.errors}`)}catch(a){throw new Error(a instanceof Error?a.message:"Network error")}h(0,(e.name,e.size))},buttonLabel:"Upload CSV",showProgress:!0,uploadId:he||void 0,onProcessingErrors:_e}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("h3",{className:"text-sm font-semibold text-blue-800 dark:text-blue-200 mr-2",children:"CSV Upload Format:"}),e.jsxs("div",{className:"relative group inline-block",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"w-4 h-4 text-blue-600 dark:text-blue-300 cursor-pointer",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z"})}),e.jsxs("div",{className:"absolute left-1/2 transform -translate-x-1/2 top-full mt-2 w-64 p-3 rounded-lg shadow-lg bg-gray-800 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-300 z-50 pointer-events-none",children:[e.jsx("div",{className:"mb-1",children:"Your CSV file SHOULD include these columns (in any order):"}),e.jsx("div",{className:"font-mono",children:"customer_name, customer_phone, customer_email, customer_address, product_name, quantity, unit_price, order_source"}),e.jsxs("div",{className:"mt-2",children:[e.jsx("strong",{children:"Example:"})," John Doe, +1234567890, john@email.com, 123 Main St, Product A, 2, 25.50"]}),e.jsxs("div",{className:"mt-1",children:[e.jsx("strong",{children:"Note:"}),' You can also use spaces in column names like "Customer Name" instead of "customer_name"']}),e.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 w-3 h-3 bg-gray-800 rotate-45"})]})]})]}),e.jsx(o,{onDownloadCSV:()=>{const e=[["Order ID","Customer ID","Customer Name","Channel","Status","Payment Status","Unit Price","Amount","Date"],...qe.map(e=>[e.orderId,e.customerId,e.customerName,e.channel,e.status,e.paymentStatus||"pending",e.order_items&&e.order_items.length>0?e.order_items.map(e=>`${g(e.price_per_unit)} (${e.quantity}x)`).join("; "):"N/A",e.amount,e.date])].map(e=>e.map(e=>`"${e}"`).join(",")).join("\n"),t=new Blob([e],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a"),a=URL.createObjectURL(t);r.setAttribute("href",a),r.setAttribute("download",`orders_${(new Date).toISOString().split("T")[0]}.csv`),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r),h(0,qe.length)},onDownloadExcel:()=>{const e=qe.map(e=>[e.orderId,e.customerId,e.customerName,e.channel,e.status,e.paymentStatus||"pending",e.order_items&&e.order_items.length>0?e.order_items.map(e=>`${g(e.price_per_unit)} (${e.quantity}x)`).join("; "):"N/A",e.amount,e.date]),t=c.aoa_to_sheet([["Order ID","Customer ID","Customer Name","Channel","Status","Payment Status","Unit Price","Amount","Date"],...e]),r=c.book_new();c.book_append_sheet(r,t,"Orders"),m(r,`orders_${(new Date).toISOString().split("T")[0]}.xlsx`),h(0,qe.length)},onDownloadPDF:()=>{const e=new x;e.setFontSize(16),e.text("Orders Report",14,15),e.setFontSize(10),e.text(`Generated on: ${(new Date).toLocaleDateString()}`,14,25);const t=qe.map(e=>[e.orderId,e.customerId,e.customerName,e.channel,e.status,e.paymentStatus||"pending",e.order_items&&e.order_items.length>0?e.order_items.map(e=>`${g(e.price_per_unit)} (${e.quantity}x)`).join("; "):"N/A",g(e.amount),e.date]);u(e,{head:[["Order ID","Customer ID","Customer Name","Channel","Status","Payment Status","Unit Price","Amount","Date"]],body:t,startY:35,styles:{fontSize:8},headStyles:{fillColor:[66,139,202]}}),e.save(`orders_${(new Date).toISOString().split("T")[0]}.pdf`),h(0,qe.length)}}),K.length>0&&e.jsxs("button",{onClick:()=>Z(!0),className:"px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 transition-colors flex items-center space-x-2",title:"View processing errors",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),e.jsxs("span",{children:["Processing Errors (",K.length,")"]})]})]})]}),e.jsx("div",{className:"hidden lg:block overflow-x-auto bg-white dark:bg-gray-800 rounded-lg shadow-md",children:e.jsxs("table",{className:"w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider w-1/6",children:"Order ID"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider w-1/6",children:"Customer ID"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider w-1/4",children:"Customer Name"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider w-1/6",children:"Channel"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider w-1/6",children:"Type"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider w-1/12",children:"View More"})]})}),e.jsx("tbody",{className:"bg-light-pink-100 dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:0===ze.length?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-4 text-center text-gray-500 dark:text-gray-400",children:b?"Loading orders...":"admin"===De?"No orders found. Upload a CSV file or create orders manually.":"No orders assigned to you yet. Contact your admin to assign orders."})}):ze.map(t=>e.jsxs(r.Fragment,{children:[e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white",children:t.orderId}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:t.customerId}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:t.customerName}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:t.channel}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:t.type}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsx("button",{onClick:()=>Se(t.id),className:"text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-200 text-sm font-medium px-3 py-1 rounded border border-blue-300 hover:bg-blue-50 dark:hover:bg-blue-900 transition-colors",children:ye.has(t.id)?"View Less":"View More"})})]}),ye.has(t.id)&&e.jsx("tr",{className:"bg-gray-50 dark:bg-gray-700 relative z-10",children:e.jsxs("td",{colSpan:6,className:"px-6 py-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Order Status"}),e.jsx("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full "+("delivered"===t.status?"bg-green-100 text-green-800":"shipped"===t.status?"bg-blue-100 text-blue-800":"confirmed"===t.status?"bg-purple-100 text-purple-800":"assigned"===t.status?"bg-indigo-100 text-indigo-800":"pending"===t.status?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:t.status})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Payment"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full "+("paid"===t.paymentStatus?"bg-green-100 text-green-800":"failed"===t.paymentStatus?"bg-red-100 text-red-800":"refunded"===t.paymentStatus?"bg-gray-100 text-gray-800":"bg-yellow-100 text-yellow-800"),children:t.paymentStatus||"pending"}),e.jsxs("div",{className:"flex space-x-1 relative z-20",children:[e.jsx("button",{onClick:()=>Ge(t,"paid"),disabled:"paid"===t.paymentStatus,className:"px-2 py-1 text-xs rounded relative z-20 "+("paid"===t.paymentStatus?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-green-500 text-white hover:bg-green-600"),children:"Mark Paid"}),e.jsx("button",{onClick:()=>Ge(t,"pending"),disabled:"pending"===t.paymentStatus||"paid"===t.paymentStatus,className:"px-2 py-1 text-xs rounded relative z-20 "+("pending"===t.paymentStatus||"paid"===t.paymentStatus?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-yellow-500 text-white hover:bg-yellow-600"),children:"Mark Pending"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Unit Price"}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:t.order_items&&t.order_items.length>0?e.jsx("div",{className:"space-y-1",children:t.order_items.map((r,a)=>e.jsxs("div",{className:"text-xs",children:[g(r.price_per_unit)," (",r.quantity,"x)"]},`${t.id}-item-${a}-${r.product_id}`))}):"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Amount"}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:ie===parseInt(t.id,10)?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-500 mr-2"}),e.jsx("span",{className:"text-blue-500",children:"Updating..."})]}):g(t.amount)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Date"}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:t.date})]})]}),t.order_items&&t.order_items.length>0&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-600",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-2",children:"Products Ordered"}),e.jsx("div",{className:"space-y-2",children:t.order_items.map((r,a)=>e.jsx("div",{className:"bg-gray-50 dark:bg-gray-600 p-3 rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Product:"}),e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:r.product_name||"Unknown Product"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"SKU:"}),e.jsx("div",{className:"font-mono text-gray-900 dark:text-white",children:r.sku||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Qty × Price:"}),e.jsxs("div",{className:"text-gray-900 dark:text-white",children:[r.quantity," × ",g(r.price_per_unit)," = ",g(r.total_price)]})]})]})},`${t.id}-product-${a}-${r.product_id}`))})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-600",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400",children:"Actions"}),e.jsx("button",{onClick:()=>Te(t.customerId),className:"text-xs px-3 py-1 bg-indigo-500 text-white rounded hover:bg-indigo-600 transition-colors",children:"More Customer Details"})]}),"admin"===De?e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs("select",{value:t.status,onChange:e=>Je(t.id,e.target.value),disabled:"delivered"===t.status||"cancelled"===t.status||"returned"===t.status,className:"text-sm border border-gray-300 dark:border-gray-600 rounded px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white "+("delivered"===t.status||"cancelled"===t.status?"opacity-50 cursor-not-allowed":""),children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"assigned",children:"Assigned"}),e.jsx("option",{value:"confirmed",children:"Confirmed"}),e.jsx("option",{value:"shipped",children:"Shipped"}),e.jsx("option",{value:"delivered",children:"Delivered"}),e.jsx("option",{value:"cancelled",children:"Cancelled"}),e.jsx("option",{value:"returned",children:"Returned"})]}),e.jsx("button",{onClick:()=>Be(t),disabled:"confirmed"!==t.status||!!t.user_id,className:"text-sm px-4 py-2 rounded border "+("confirmed"!==t.status||t.user_id?"text-gray-400 cursor-not-allowed border-gray-300":"text-green-600 hover:text-green-900 dark:text-green-400 dark:hover:text-green-200 border-green-300 hover:bg-green-50 dark:hover:bg-green-900"),title:"confirmed"!==t.status?"Can only assign confirmed orders":t.user_id?"Order already assigned":"",children:"confirmed"!==t.status||t.user_id?"Assigned":"Assign"}),e.jsx("button",{onClick:()=>We(t),disabled:!["confirmed","delivered","assigned","shipped","cancelled"].includes(t.status)||"pending"===t.paymentStatus&&"cancelled"!==t.status,className:"text-sm px-4 py-2 rounded border ml-2 "+(!["confirmed","delivered","assigned","shipped","cancelled"].includes(t.status)||"pending"===t.paymentStatus&&"cancelled"!==t.status?"text-gray-400 cursor-not-allowed border-gray-300":"text-orange-600 hover:text-orange-900 dark:text-orange-400 dark:hover:text-orange-200 border-orange-300 hover:bg-orange-50 dark:hover:bg-orange-900"),title:"pending"===t.paymentStatus&&"cancelled"!==t.status?"Cannot return unpaid orders":"cancelled"===t.status?"Can return cancelled orders":"",children:"Returned"})]}):e.jsxs("select",{value:t.status,onChange:e=>Je(t.id,e.target.value),disabled:"delivered"===t.status||"cancelled"===t.status||"returned"===t.status,className:"text-sm border border-gray-300 dark:border-gray-600 rounded px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white "+("delivered"===t.status||"cancelled"===t.status?"opacity-50 cursor-not-allowed":""),children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"assigned",children:"Assigned"}),e.jsx("option",{value:"confirmed",children:"Confirmed"}),e.jsx("option",{value:"shipped",children:"Shipped"}),e.jsx("option",{value:"delivered",children:"Delivered"}),e.jsx("option",{value:"cancelled",children:"Cancelled"}),e.jsx("option",{value:"returned",children:"Returned"})]})]})]})})]},t.id))})]})}),Fe>1&&e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-700 dark:text-gray-300",children:["Showing ",(Ce-1)*Ie+1," to ",Math.min(Ce*Ie,v)," of ",v," results"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>{const e=Math.max(Ce-1,1);Pe(e),Ee(e)},disabled:1===Ce,className:"px-3 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),e.jsxs("span",{className:"px-3 py-1 text-sm text-gray-700 dark:text-gray-300",children:["Page ",Ce," of ",Fe]}),e.jsx("button",{onClick:()=>{const e=Math.min(Ce+1,Fe);Pe(e),Ee(e)},disabled:Ce===Fe,className:"px-3 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})]}),e.jsx("div",{className:"lg:hidden grid gap-4",children:0===ze.length?e.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400 bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:b?"Loading orders...":"admin"===De?"No orders found. Upload a CSV file or create orders manually.":"No orders assigned to you yet. Contact your admin to assign orders."}):ze.map(t=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md border border-gray-200 dark:border-gray-700 p-4 hover:shadow-lg transition-shadow",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:t.orderId}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:t.customerName})]}),e.jsx("button",{onClick:()=>Se(t.id),className:"text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-200 text-sm font-medium px-3 py-1 rounded border border-blue-300 hover:bg-blue-50 dark:hover:bg-blue-900 transition-colors",children:ye.has(t.id)?"View Less":"View More"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Customer ID"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t.customerId})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Channel"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t.channel})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Type"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t.type})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Date"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t.date})]})]}),ye.has(t.id)&&e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-600 pt-4 mt-4",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Order Status"}),e.jsx("span",{className:"px-2 py-1 text-xs font-semibold rounded-full "+("delivered"===t.status?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"shipped"===t.status?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":"confirmed"===t.status?"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200":"assigned"===t.status?"bg-indigo-100 text-indigo-800 dark:bg-indigo-900 dark:text-indigo-200":"pending"===t.status?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"),children:t.status})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-2",children:"Payment Status"}),e.jsx("div",{className:"flex items-center space-x-2 mb-2",children:e.jsx("span",{className:"px-2 py-1 text-xs font-semibold rounded-full "+("paid"===t.paymentStatus?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"failed"===t.paymentStatus?"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200":"refunded"===t.paymentStatus?"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200":"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200"),children:t.paymentStatus||"pending"})}),e.jsxs("div",{className:"flex space-x-2 relative z-20",children:[e.jsx("button",{onClick:()=>Ge(t,"paid"),disabled:"paid"===t.paymentStatus,className:"px-3 py-1 text-xs rounded relative z-20 "+("paid"===t.paymentStatus?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-green-500 text-white hover:bg-green-600"),children:"Mark Paid"}),e.jsx("button",{onClick:()=>Ge(t,"pending"),disabled:"pending"===t.paymentStatus||"paid"===t.paymentStatus,className:"px-3 py-1 text-xs rounded relative z-20 "+("pending"===t.paymentStatus||"paid"===t.paymentStatus?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-yellow-500 text-white hover:bg-yellow-600"),children:"Mark Pending"})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Unit Price"}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:t.order_items&&t.order_items.length>0?e.jsx("div",{className:"space-y-1",children:t.order_items.map((r,a)=>e.jsxs("div",{className:"text-xs",children:[g(r.price_per_unit)," (",r.quantity,"x)"]},`${t.id}-mobile-item-${a}-${r.product_id}`))}):"N/A"})]}),e.jsxs("div",{className:"mb-3 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Total Amount"}),e.jsx("div",{className:"text-xl font-bold text-gray-900 dark:text-white",children:ie===parseInt(t.id,10)?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-500 mr-2"}),e.jsx("span",{className:"text-sm text-blue-500",children:"Updating..."})]}):g(t.amount)})]}),t.order_items&&t.order_items.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-2",children:"Products Ordered"}),e.jsx("div",{className:"space-y-2",children:t.order_items.map((r,a)=>e.jsx("div",{className:"bg-gray-50 dark:bg-gray-600 p-3 rounded-lg",children:e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Product:"}),e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:r.product_name||"Unknown Product"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"SKU:"}),e.jsx("div",{className:"font-mono text-gray-900 dark:text-white",children:r.sku||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Qty × Price:"}),e.jsxs("div",{className:"text-gray-900 dark:text-white",children:[r.quantity," × ",g(r.price_per_unit)," = ",g(r.total_price)]})]})]})},`${t.id}-mobile-product-${a}-${r.product_id}`))})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Actions"}),e.jsx("button",{onClick:()=>Te(t.customerId),className:"text-xs px-3 py-1 bg-indigo-500 text-white rounded hover:bg-indigo-600 transition-colors",children:"More Customer Details"})]}),"admin"===De?e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsxs("select",{value:t.status,onChange:e=>Je(t.id,e.target.value),disabled:"delivered"===t.status||"cancelled"===t.status,className:"text-sm border border-gray-300 dark:border-gray-600 rounded px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white "+("delivered"===t.status||"cancelled"===t.status?"opacity-50 cursor-not-allowed":""),children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"assigned",children:"Assigned"}),e.jsx("option",{value:"confirmed",children:"Confirmed"}),e.jsx("option",{value:"shipped",children:"Shipped"}),e.jsx("option",{value:"delivered",children:"Delivered"}),e.jsx("option",{value:"cancelled",children:"Cancelled"}),e.jsx("option",{value:"returned",children:"Returned"})]}),e.jsx("button",{onClick:()=>Be(t),disabled:"confirmed"!==t.status||!!t.user_id,className:"text-sm px-4 py-2 rounded border "+("confirmed"!==t.status||t.user_id?"text-gray-400 cursor-not-allowed border-gray-300":"text-green-600 hover:text-green-900 dark:text-green-400 dark:hover:text-green-200 border-green-300 hover:bg-green-50 dark:hover:bg-green-900"),title:"confirmed"!==t.status?"Can only assign confirmed orders":t.user_id?"Order already assigned":"",children:"confirmed"!==t.status||t.user_id?"Assigned":"Assign"}),e.jsx("button",{onClick:()=>We(t),disabled:!["confirmed","delivered","assigned","shipped","cancelled"].includes(t.status)||"pending"===t.paymentStatus&&"cancelled"!==t.status,className:"text-sm px-4 py-2 rounded border ml-2 "+(!["confirmed","delivered","assigned","shipped","cancelled"].includes(t.status)||"pending"===t.paymentStatus&&"cancelled"!==t.status?"text-gray-400 cursor-not-allowed border-gray-300":"text-orange-600 hover:text-orange-900 dark:text-orange-400 dark:hover:text-orange-200 border-orange-300 hover:bg-orange-50 dark:hover:bg-orange-900"),title:"pending"===t.paymentStatus&&"cancelled"!==t.status?"Cannot return unpaid orders":"cancelled"===t.status?"Can return cancelled orders":"",children:"Returned"})]}):e.jsxs("select",{value:t.status,onChange:e=>Je(t.id,e.target.value),disabled:"delivered"===t.status||"cancelled"===t.status,className:"text-sm border border-gray-300 dark:border-gray-600 rounded px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white w-full "+("delivered"===t.status||"cancelled"===t.status?"opacity-50 cursor-not-allowed":""),children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"assigned",children:"Assigned"}),e.jsx("option",{value:"confirmed",children:"Confirmed"}),e.jsx("option",{value:"shipped",children:"Shipped"}),e.jsx("option",{value:"delivered",children:"Delivered"}),e.jsx("option",{value:"cancelled",children:"Cancelled"}),e.jsx("option",{value:"returned",children:"Returned"})]})]})]})]},t.id))}),e.jsxs("div",{className:"mt-6 text-gray-600 dark:text-gray-400",children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Additional Features Placeholder:"}),e.jsxs("ul",{className:"list-disc list-inside",children:[e.jsx("li",{children:"Detailed order view on click"}),e.jsx("li",{children:"Pagination for large datasets"})]})]}),T&&q&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-md w-full mx-4",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:["Assign Order #",q.orderId]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Assign to Employee:"}),e.jsxs("select",{value:V.userId,onChange:e=>B({...V,userId:e.target.value}),className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[e.jsx("option",{value:"",children:"Select Employee"}),R.map(t=>e.jsxs("option",{value:t.user_id,children:[t.username," (",t.role,")"]},`employee-${t.user_id}`))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Delivery Notes:"}),e.jsx("textarea",{value:V.deliveryNotes,onChange:e=>B({...V,deliveryNotes:e.target.value}),placeholder:"Special instructions for delivery...",className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",rows:3})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-6",children:[e.jsx("button",{onClick:()=>E(!1),className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:"Cancel"}),e.jsx("button",{onClick:async()=>{if(q&&V.userId)try{(await fetch(i("/api/orders/assign"),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({orderId:q.id,userId:V.userId,deliveryNotes:V.deliveryNotes})})).ok?(y(e=>e.map(e=>e.id===q.id?{...e,user_id:parseInt(V.userId),status:"assigned"}:e)),alert("Order assigned successfully!"),E(!1),B({userId:"",deliveryNotes:""}),F(null)):alert("Failed to assign order")}catch(e){alert("Failed to assign order")}},disabled:!V.userId,className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50",children:"Assign Order"})]})]})}),oe&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:"Add New Order"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Customer Name",name:"customer_name",className:"w-full p-2 border rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white "+(ue.customerName?"border-red-500":"border-gray-300 dark:border-gray-600"),value:me.customerName,onChange:e=>xe({...me,customerName:e.target.value})}),ue.customerName&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:ue.customerName}),e.jsx("input",{type:"tel",placeholder:"Customer Phone",name:"customer_phone",pattern:"[6-9][0-9]{9}",title:"Please enter a valid 10-digit Indian phone number",className:"w-full p-2 border rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white "+(ue.customerPhone?"border-red-500":"border-gray-300 dark:border-gray-600"),value:me.customerPhone,onChange:e=>{return t=e.target.value,xe({...me,customerPhone:t}),void(t.trim()&&!Le(t)?ge({...ue,customerPhone:"Please enter a valid Indian phone number (10-13 digits)"}):ge({...ue,customerPhone:""}));var t}}),ue.customerPhone&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:ue.customerPhone}),e.jsx("input",{type:"email",placeholder:"Customer Email",name:"customer_email",className:"w-full p-2 border rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white "+(ue.customerEmail?"border-red-500":"border-gray-300 dark:border-gray-600"),value:me.customerEmail,onChange:e=>{return t=e.target.value,xe({...me,customerEmail:t}),void(t.trim()&&!Oe(t)?ge({...ue,customerEmail:"Please enter a valid email address"}):ge({...ue,customerEmail:""}));var t}}),ue.customerEmail&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:ue.customerEmail}),"Manual"!==me.orderSource&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-600 pt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Address Details"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("input",{type:"text",placeholder:"Address Line 1 *",name:"address_line1",className:"w-full p-2 border rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white "+(ue.addressLine1?"border-red-500":"border-gray-300 dark:border-gray-600"),value:me.addressLine1,onChange:e=>xe({...me,addressLine1:e.target.value})}),ue.addressLine1&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:ue.addressLine1})]}),e.jsx("div",{className:"mb-3",children:e.jsx("input",{type:"text",placeholder:"Address Line 2 (Optional)",name:"address_line2",className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:me.addressLine2,onChange:e=>xe({...me,addressLine2:e.target.value})})}),e.jsx("div",{className:"mb-3",children:e.jsx("input",{type:"text",placeholder:"Landmark",name:"landmark",className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:me.landmark,onChange:e=>{const t=e.target.value;xe({...me,landmark:t}),Ue(t,me.pincode)}})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-3",children:[e.jsxs("div",{children:[e.jsx("input",{type:"text",placeholder:"City *",name:"city",className:"w-full p-2 border rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white "+(ue.city?"border-red-500":"border-gray-300 dark:border-gray-600"),value:me.city,onChange:e=>xe({...me,city:e.target.value})}),ue.city&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:ue.city})]}),e.jsxs("div",{children:[e.jsx("input",{type:"text",placeholder:"State *",name:"state",className:"w-full p-2 border rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white "+(ue.state?"border-red-500":"border-gray-300 dark:border-gray-600"),value:me.state,onChange:e=>xe({...me,state:e.target.value})}),ue.state&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:ue.state})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"Pincode *",name:"pincode",className:"w-full p-2 border rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white "+(ue.pincode?"border-red-500":"border-gray-300 dark:border-gray-600"),value:me.pincode,onChange:e=>{const t=e.target.value;xe({...me,pincode:t}),Ue(me.landmark,t)}}),je&&e.jsx("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2",children:e.jsx("div",{className:"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"})})]}),ue.pincode&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:ue.pincode})]}),e.jsx("div",{children:e.jsx("input",{type:"text",placeholder:"Country",name:"country",className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:me.country,onChange:e=>xe({...me,country:e.target.value})})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("input",{type:"tel",placeholder:"Alternate Phone (Optional)",name:"alternate_phone",className:"w-full p-2 border rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white "+(ue.alternatePhone?"border-red-500":"border-gray-300 dark:border-gray-600"),value:me.alternatePhone,onChange:e=>xe({...me,alternatePhone:e.target.value})}),ue.alternatePhone&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:ue.alternatePhone})]}),e.jsx("div",{className:"mb-3",children:e.jsx("textarea",{placeholder:"Delivery Note (Optional)",name:"delivery_note",className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",rows:2,value:me.deliveryNote,onChange:e=>xe({...me,deliveryNote:e.target.value})})}),e.jsxs("div",{className:"mb-3",children:[e.jsx("input",{type:"text",placeholder:"Customer State Code (Optional)",name:"state_code",maxLength:2,className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:me.state_code,onChange:e=>xe({...me,state_code:e.target.value})}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"2-digit state code (e.g., 19 for West Bengal)"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("input",{type:"text",placeholder:"Customer GST Number (Optional)",name:"gst_number",maxLength:15,className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:me.gst_number,onChange:e=>xe({...me,gst_number:e.target.value})}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"15-character GST number (e.g., 22AAAAA0000A1Z5)"})]})]})}),e.jsx("input",{type:"text",placeholder:"Product Name",name:"product_name",className:"w-full p-2 border rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white "+(ue.productName?"border-red-500":"border-gray-300 dark:border-gray-600"),value:me.productName,onChange:e=>xe({...me,productName:e.target.value})}),ue.productName&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:ue.productName}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Quantity:"}),e.jsx("input",{type:"number",placeholder:"Enter quantity",name:"quantity",min:"1",className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:me.quantity,onChange:e=>xe({...me,quantity:parseInt(e.target.value)||1})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Unit Price:"}),e.jsx("input",{type:"number",placeholder:"Enter unit price",name:"unit_price",step:"0.01",min:"0",className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:me.unitPrice,onChange:e=>xe({...me,unitPrice:parseFloat(e.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Order Source:"}),e.jsxs("select",{name:"order_source",className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:me.orderSource,onChange:e=>{const t=e.target.value;"Manual"===t?(xe({...me,orderSource:t,addressLine1:"",addressLine2:"",landmark:"",city:"",state:"",pincode:"",country:"India",alternatePhone:"",deliveryNote:"",state_code:"",gst_number:""}),ge({...ue,addressLine1:"",addressLine2:"",landmark:"",city:"",state:"",pincode:"",country:"",alternatePhone:"",deliveryNote:""})):xe({...me,orderSource:t})},children:[e.jsx("option",{value:"Manual",children:"Manual"}),e.jsx("option",{value:"Phone",children:"Phone"}),e.jsx("option",{value:"Email",children:"Email"}),e.jsx("option",{value:"Website",children:"Website"}),e.jsx("option",{value:"WhatsApp",children:"WhatsApp"})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-6",children:[e.jsx("button",{onClick:()=>ce(!1),className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:"Cancel"}),e.jsx("button",{onClick:async()=>{if((()=>{const e={customerName:"",customerPhone:"",customerEmail:"",addressLine1:"",addressLine2:"",landmark:"",city:"",state:"",pincode:"",country:"",alternatePhone:"",deliveryNote:"",productName:""};let t=!0;return me.customerName.trim()||(e.customerName="Customer name is required",t=!1),me.customerPhone.trim()?Le(me.customerPhone)||(e.customerPhone="Please enter a valid Indian phone number (10-13 digits)",t=!1):(e.customerPhone="Phone number is required",t=!1),me.customerEmail.trim()&&!Oe(me.customerEmail)&&(e.customerEmail="Please enter a valid email address",t=!1),"Manual"!==me.orderSource&&(me.addressLine1.trim()||(e.addressLine1="Address Line 1 is required for non-manual orders",t=!1),me.city.trim()||(e.city="City is required for non-manual orders",t=!1),me.state.trim()||(e.state="State is required for non-manual orders",t=!1),me.pincode.trim()||(e.pincode="Pincode is required for non-manual orders",t=!1)),me.alternatePhone.trim()&&!Le(me.alternatePhone)&&(e.alternatePhone="Please enter a valid Indian phone number (10-13 digits)",t=!1),me.productName.trim()||(e.productName="Product name is required",t=!1),ge(e),t})())try{const e=await fetch(i("/api/orders/add-manual"),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(me)});if(e.ok){const t=await e.json(),r={id:t.order_id.toString(),orderId:`ORD${t.order_id}`,customerId:`CUS${t.customer_id}`,customerName:t.customer_name||"Unknown",amount:parseFloat(t.display_amount)||0,status:t.status||"pending",date:new Date(t.order_date||t.created_at).toISOString().split("T")[0],channel:t.order_source||"Unknown",type:"Standard",customer:t.customer_name||"Unknown",paymentStatus:t.payment_status||"pending",user_id:t.user_id,order_items:t.order_items||[{product_id:0,product_name:me.productName,quantity:me.quantity,price_per_unit:me.unitPrice,total_price:me.quantity*me.unitPrice,sku:"SKU"}]};y(e=>[r,...e]),ce(!1),xe({customerName:"",customerPhone:"",customerEmail:"",addressLine1:"",addressLine2:"",landmark:"",city:"",state:"",pincode:"",country:"India",alternatePhone:"",isVerifiedAddress:!1,deliveryNote:"",productName:"",quantity:0,unitPrice:0,orderSource:"Manual",state_code:"",gst_number:""}),ge({customerName:"",customerPhone:"",customerEmail:"",addressLine1:"",addressLine2:"",landmark:"",city:"",state:"",pincode:"",country:"",alternatePhone:"",deliveryNote:"",productName:""}),await Me(),setTimeout(()=>{alert(`Order added successfully!\n\nOrder ID: ${r.orderId}\nCustomer: ${r.customerName}\nProduct: ${me.productName}\nTotal: ${g(r.amount)}`)},100)}else{const t=await e.json();401===e.status?(alert("Session expired. Please log in again."),window.location.href="/login"):alert(`Failed to add order: ${t.message||"Unknown error"}`)}}catch(e){alert("Failed to add order: Network error")}},disabled:!me.customerName||!me.productName,className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50",children:"Add Order"})]})]})}),X&&te&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-md w-full mx-4",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:["Update Unit Price & Mark as Paid - Order #",te.orderId]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Unit Price:"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:ae.pricePerUnit,onChange:e=>se({...ae,pricePerUnit:parseFloat(e.target.value)||0}),className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"Enter unit price"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Payment Method:"}),e.jsxs("select",{value:ae.paymentMethod,onChange:e=>se({...ae,paymentMethod:e.target.value}),className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"card",children:"Card"}),e.jsx("option",{value:"upi",children:"UPI"}),e.jsx("option",{value:"bank_transfer",children:"Bank Transfer"}),e.jsx("option",{value:"cheque",children:"Cheque"}),e.jsx("option",{value:"other",children:"Other"})]})]}),te&&ae.pricePerUnit>0&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-3 rounded-md border border-blue-200 dark:border-blue-800",children:[e.jsx("div",{className:"text-sm text-blue-800 dark:text-blue-200",children:e.jsx("strong",{children:"Preview:"})}),e.jsxs("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:["Current Total: ",g(te.amount)]}),(()=>{var t;const r=((null==(t=te.order_items)?void 0:t.reduce((e,t)=>e+t.quantity,0))||0)*ae.pricePerUnit;return e.jsxs("div",{className:"text-sm font-semibold text-green-700 dark:text-green-300",children:["New Total: ",g(r)]})})()]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-6",children:[e.jsx("button",{onClick:()=>ee(!1),className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:"Cancel"}),e.jsx("button",{onClick:async()=>{if(te){ne(!0);try{await He(parseInt(te.id,10),"paid",ae.paymentMethod,void 0,ae.pricePerUnit),setTimeout(()=>{ee(!1),re(null),se({pricePerUnit:0,paymentMethod:"cash"}),ne(!1)},800)}catch(e){ne(!1)}}},disabled:ae.pricePerUnit<=0||de,className:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 disabled:opacity-50",children:de?"Updating...":"Mark as Paid & Update Price"})]})]})}),Y&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-4xl w-full mx-4 max-h-[80vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:["Processing Errors (",K.length,")"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:()=>{Q([]),localStorage.removeItem("orders-processing-errors"),Z(!1)},className:"px-3 py-1 bg-red-500 text-white text-sm rounded hover:bg-red-600 transition-colors flex items-center space-x-1",title:"Clear all errors",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),e.jsx("span",{children:"Clear"})]}),e.jsx("button",{onClick:()=>Z(!1),className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",title:"Close",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 p-4 rounded-md",children:e.jsx("div",{className:"space-y-2",children:K.map((t,r)=>e.jsxs("div",{className:"text-sm text-red-700 dark:text-red-300 break-words border-b border-red-200 dark:border-red-800 pb-2 last:border-b-0",children:[e.jsxs("span",{className:"font-medium text-red-800 dark:text-red-200",children:["#",r+1,":"]})," ",t]},`error-${r}-${t.slice(0,20)}`))})})}),e.jsx("div",{className:"flex justify-end mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsx("button",{onClick:()=>Z(!1),className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors",children:"Close"})})]})}),ke&&we&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Customer Details"}),e.jsx("button",{onClick:()=>{Ne(!1),fe(null)},className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Name"}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-white",children:we.name||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Phone Number"}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-white",children:we.phone||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Email"}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-white",children:we.email||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"City"}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-white",children:we.city||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"State"}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-white",children:we.state||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Pincode"}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-white",children:we.pincode||"N/A"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Address Line 1"}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-white",children:we.address_line1||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Address Line 2"}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-white",children:we.address_line2||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Landmark"}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-white",children:we.landmark||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Delivery Note"}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-white",children:we.delivery_note||"N/A"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"State Code"}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-white",children:we.state_code||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"GST Number"}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-white font-mono",children:we.gst_number||"N/A"})]})]})]}),e.jsx("div",{className:"flex justify-end mt-6",children:e.jsx("button",{onClick:()=>{Ne(!1),fe(null)},className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors",children:"Close"})})]})}),W&&q&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:["Return Order #",q.orderId]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Return Reason:"}),e.jsx("textarea",{value:H.reason,onChange:e=>G({...H,reason:e.target.value}),placeholder:"Please specify the reason for return...",className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",rows:3,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Items to Return:"}),e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:H.returnItems.map((t,r)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-md",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:["Product ID: ",t.product_id]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Quantity: ",t.quantity," × ₹",t.unit_price," = ₹",t.total_amount]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("label",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Original Qty:"}),e.jsx("input",{type:"number",value:t.quantity,readOnly:!0,className:"w-16 px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 cursor-not-allowed"})]})]},r))})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{onClick:()=>{J(!1),G({reason:"",returnItems:[]}),F(null)},className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-600 hover:bg-gray-200 dark:hover:bg-gray-500 rounded-md transition-colors",children:"Cancel"}),e.jsx("button",{onClick:async()=>{if(q&&H.reason.trim())try{const e=await fetch(i("/api/orders/return"),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({order_id:q.id,customer_id:q.customerId.replace("CUS",""),reason:H.reason,return_items:H.returnItems})});if(e.ok)Ee(),alert("Return request submitted successfully!"),J(!1),G({reason:"",returnItems:[]}),F(null);else{const t=await e.json();alert(`Failed to submit return: ${t.message||"Unknown error"}`)}}catch(e){alert("Failed to submit return request")}},disabled:!H.reason.trim(),className:"px-4 py-2 text-sm font-medium text-white rounded-md transition-colors "+(H.reason.trim()?"bg-orange-600 hover:bg-orange-700":"bg-gray-400 cursor-not-allowed"),children:"Submit Return Request"})]})]})]})})]})}export{p as default};
