import{j as e}from"./framer-motion-CP1hDTrg.js";import{r as t,a,b as r}from"./react-vendor-CFOUl9e9.js";import{L as s}from"./Layout-D0rQz-4W.js";import{b as d,a as l,g as n}from"./index-Zg8dsWBS.js";import{F as i}from"./FileUpload-DdCe1LmD.js";import{D as o,u as c,w as x,E as m,a as u}from"./jspdf.plugin.autotable-BWxvZjXE.js";import{f as g}from"./currency-CLTscsdx.js";import"./Footer-D5Bc2McR.js";import"./lucide-Jis9dCxC.js";function h(){const[h,b]=t.useState([]),[y,p]=t.useState(!0),[j,v]=t.useState(""),[k,w]=t.useState("all"),[N,f]=t.useState(!1),[_,S]=t.useState({orderId:"",dueDate:"",notes:"",discountAmount:0}),[D,C]=t.useState(null),[I,T]=t.useState(!1),[O,P]=t.useState(null),[$,G]=t.useState({dueDate:"",notes:"",discountAmount:0,paymentStatus:"unpaid",paymentMethod:""}),[F,A]=t.useState(new Set),[M,U]=t.useState(1),[L]=t.useState(50),[R,V]=t.useState(0),[z,E]=t.useState(0),{user:B}=d();l();const H=(null==B?void 0:B.role)||"admin";t.useEffect(()=>{J()},[M,j,k]);const J=async()=>{var e,t;try{p(!0);const a=new URLSearchParams({page:M.toString(),limit:L.toString()});j&&a.append("search",j),"all"!==k&&a.append("status",k);const r=await fetch(n(`/api/invoices?${a}`),{credentials:"include"});if(r.ok){const a=await r.json();b(a.invoices||[]),V((null==(e=a.pagination)?void 0:e.total)||0),E((null==(t=a.pagination)?void 0:t.totalPages)||0)}}catch(a){}finally{p(!1)}},W=e=>{P(e),G({dueDate:e.due_date.split("T")[0],notes:e.notes||"",discountAmount:e.discount_amount,paymentStatus:e.payment_status,paymentMethod:e.payment_method||""}),T(!0)};t.useEffect(()=>{1!==M&&U(1)},[j,k]);const Y=(M-1)*L,q=Math.min(Y+L,R);return y?e.jsxs(s,{children:[e.jsx("h1",{className:"text-3xl font-bold heading-gradient mb-6",children:"Invoice Management"}),e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"text-lg text-slate-300",children:"Loading invoices..."})})]}):e.jsxs(s,{children:[e.jsx("h1",{className:"text-3xl font-bold heading-gradient mb-6",children:"Invoice Management"}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center mb-6 space-y-4 sm:space-y-0",children:[e.jsx("input",{type:"text",placeholder:"Search by customer name...",value:j,onChange:e=>v(e.target.value),className:"w-full sm:w-1/3 p-2 border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-white"}),e.jsxs("select",{value:k,onChange:e=>w(e.target.value),className:"w-full sm:w-1/4 p-2 border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-white",children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"unpaid",children:"Unpaid"}),e.jsx("option",{value:"paid",children:"Paid"}),e.jsx("option",{value:"partially_paid",children:"Partially Paid"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]}),"admin"===H&&e.jsxs("div",{className:"mb-6 flex flex-col sm:flex-row items-center space-y-4 sm:space-y-0 sm:space-x-4",children:[e.jsx(i,{onFileUpload:async e=>{const t=`upload_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;C(t);const a=new FormData;a.append("file",e),a.append("uploadId",t);try{const e=await fetch(n("/api/invoices/upload-csv"),{method:"POST",credentials:"include",body:a}),t=await e.json();if(!e.ok)throw new Error(t.message||"Upload failed");await J(),t.uploadId||alert(`${t.message}\n\nCreated: ${t.created} invoices`)}catch(r){throw new Error(r instanceof Error?r.message:"Network error")}},buttonLabel:"Upload CSV",showProgress:!0,uploadId:D||void 0}),e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg flex items-center",children:[e.jsx("h3",{className:"text-sm font-semibold text-blue-800 dark:text-blue-200 mr-2",children:"CSV Upload Format:"}),e.jsxs("div",{className:"relative group",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"w-4 h-4 text-blue-600 dark:text-blue-300 cursor-pointer",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z"})}),e.jsxs("div",{className:"absolute left-1/2 transform -translate-x-1/2 bottom-full mb-2 w-80 p-3 rounded-lg shadow-lg bg-gray-800 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-300 z-10",children:[e.jsx("p",{className:"mb-1",children:"Your CSV file should include these columns:"}),e.jsx("p",{className:"font-mono",children:"order_id, due_date, notes, discount_amount"}),e.jsxs("p",{className:"mt-2",children:[e.jsx("strong",{children:"Example:"}),' 1, 2024-02-15, "Invoice notes", 10.00']}),e.jsxs("p",{className:"mt-1",children:[e.jsx("strong",{children:"Note:"})," GST is calculated automatically from product rates. Invoice number is auto-generated."]}),e.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 w-3 h-3 bg-gray-800 rotate-45"})]})]})]})]}),e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx("button",{onClick:()=>f(!0),className:"p-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors w-full",children:"Create Invoice Manually"}),e.jsx(o,{onDownloadCSV:()=>{const e=[["Invoice Number","Order ID","Customer Name","Subtotal","CGST","SGST","IGST","Discount","Total","Status","Due Date","Created"],...h.map(e=>[e.display_number,`ORD${e.order_id}`,e.customer_name,e.subtotal,e.cgst_amount||0,e.sgst_amount||0,e.igst_amount||0,e.discount_amount,e.total_amount,e.payment_status,e.due_date,new Date(e.created_at).toLocaleDateString()])].map(e=>e.map(e=>`"${e}"`).join(",")).join("\n"),t=new Blob([e],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a"),r=URL.createObjectURL(t);a.setAttribute("href",r),a.setAttribute("download",`invoices_${(new Date).toISOString().split("T")[0]}.csv`),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a)},onDownloadExcel:()=>{const e=h.map(e=>[e.display_number,`ORD${e.order_id}`,e.customer_name,e.subtotal,e.cgst_amount||0,e.sgst_amount||0,e.igst_amount||0,e.discount_amount,e.total_amount,e.payment_status,e.due_date,new Date(e.created_at).toLocaleDateString()]),t=c.aoa_to_sheet([["Invoice Number","Order ID","Customer Name","Subtotal","CGST","SGST","IGST","Discount","Total","Status","Due Date","Created"],...e]),a=c.book_new();c.book_append_sheet(a,t,"Invoices"),x(a,`invoices_${(new Date).toISOString().split("T")[0]}.xlsx`)},onDownloadPDF:()=>{const e=new m;e.setFontSize(16),e.text("Invoices Report",14,15),e.setFontSize(10),e.text(`Generated on: ${(new Date).toLocaleDateString()}`,14,25);const t=h.map(e=>[e.display_number,`ORD${e.order_id}`,e.customer_name,g(e.subtotal),g(e.cgst_amount||0),g(e.sgst_amount||0),g(e.igst_amount||0),g(e.discount_amount),g(e.total_amount),e.payment_status,e.due_date]);u(e,{head:[["Invoice Number","Order ID","Customer","Subtotal","CGST","SGST","IGST","Discount","Total","Status","Due Date"]],body:t,startY:35,styles:{fontSize:8},headStyles:{fillColor:[66,139,202]}}),e.save(`invoices_${(new Date).toISOString().split("T")[0]}.pdf`)}})]}),e.jsx("div",{className:"hidden lg:block overflow-x-auto bg-slate-800/50 rounded-lg mb-6",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Invoice Number"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Order ID"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Customer Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Total"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"View More"})]})}),e.jsx("tbody",{className:"bg-light-pink-100 dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:0===h.length?e.jsx("tr",{children:e.jsx("td",{colSpan:10,className:"px-6 py-4 text-center text-gray-500 dark:text-gray-400",children:y?"Loading invoices...":"No invoices found. Create invoices from orders or upload CSV data."})}):h.map(t=>e.jsxs(r.Fragment,{children:[e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white",children:t.display_number}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:["ORD",t.order_id]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:t.customer_name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-bold text-gray-900 dark:text-white",children:g(t.total_amount)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsx("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full "+("paid"===t.payment_status?"bg-green-100 text-green-800":"partially_paid"===t.payment_status?"bg-yellow-100 text-yellow-800":"cancelled"===t.payment_status?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"),children:t.payment_status})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsx("button",{onClick:()=>{return e=t.invoice_id,void A(t=>{const a=new Set(t);return a.has(e)?a.delete(e):a.add(e),a});var e},className:"text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-200 text-sm font-medium px-3 py-1 rounded border border-blue-300 hover:bg-blue-50 dark:hover:bg-blue-900 transition-colors",children:F.has(t.invoice_id)?"View Less":"View More"})})]}),F.has(t.invoice_id)&&e.jsx("tr",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("td",{colSpan:6,className:"px-6 py-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Subtotal"}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:g(t.subtotal)})]}),void 0!==t.cgst_amount&&t.cgst_amount>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"CGST"}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:g(t.cgst_amount)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"SGST"}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:g(t.sgst_amount||0)})]})]}),void 0!==t.igst_amount&&t.igst_amount>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"IGST"}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:g(t.igst_amount)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Discount"}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:g(t.discount_amount)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Due Date"}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:t.due_date})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-600",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-2",children:"Actions"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>W(t),className:"px-4 py-2 text-sm bg-green-500 text-white rounded hover:bg-green-600",children:"Update"}),e.jsx("button",{onClick:()=>{window.open(`/api/invoices/${t.invoice_id}/download`,"_blank")},className:"px-4 py-2 text-sm bg-blue-500 text-white rounded hover:bg-blue-600",children:"Download"})]})]})]})})]},t.invoice_id))})]})}),z>1&&e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 mb-6",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-700 dark:text-gray-300",children:["Showing ",Y+1," to ",q," of ",R," results"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>U(e=>Math.max(e-1,1)),disabled:1===M,className:"px-3 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),e.jsxs("span",{className:"px-3 py-1 text-sm text-gray-700 dark:text-gray-300",children:["Page ",M," of ",z]}),e.jsx("button",{onClick:()=>U(e=>Math.min(e+1,z)),disabled:M===z,className:"px-3 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})]}),e.jsx("div",{className:"lg:hidden grid gap-4 mb-6",children:0===h.length?e.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400 card-surface rounded-card shadow p-6",children:y?"Loading invoices...":"No invoices found. Create invoices from orders or upload CSV data."}):h.map(t=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md border border-gray-200 dark:border-gray-700 p-4 hover:shadow-lg transition-shadow",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:t.display_number}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Order: ORD",t.order_id]})]}),e.jsx("span",{className:"px-2 py-1 text-xs font-semibold rounded-full "+("paid"===t.payment_status?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"partially_paid"===t.payment_status?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200":"cancelled"===t.payment_status?"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200":"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200"),children:t.payment_status})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Customer"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t.customer_name})]}),e.jsxs("div",{className:"mb-4 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Subtotal"}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-white",children:g(t.subtotal)})]}),void 0!==t.cgst_amount&&t.cgst_amount>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"CGST"}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-white",children:g(t.cgst_amount)})]}),e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"SGST"}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-white",children:g(t.sgst_amount||0)})]})]}),void 0!==t.igst_amount&&t.igst_amount>0&&e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"IGST"}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-white",children:g(t.igst_amount)})]}),t.discount_amount>0&&e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Discount"}),e.jsxs("p",{className:"text-sm text-gray-900 dark:text-white",children:["-",g(t.discount_amount)]})]}),e.jsx("div",{className:"border-t border-gray-300 dark:border-gray-600 pt-2",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:"Total"}),e.jsx("p",{className:"text-lg font-bold text-gray-900 dark:text-white",children:g(t.total_amount)})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Due Date"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t.due_date})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Created"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:new Date(t.created_at).toLocaleDateString()})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>W(t),className:"flex-1 px-3 py-2 text-sm bg-green-500 text-white rounded-md hover:bg-green-600",children:"Update"}),e.jsx("button",{onClick:()=>{window.open(`/api/invoices/${t.invoice_id}/download`,"_blank")},className:"flex-1 px-3 py-2 text-sm bg-blue-500 text-white rounded-md hover:bg-blue-600",children:"Download"})]})]},t.invoice_id))}),N&&a.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-[9999] p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Create New Invoice"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Order ID:"}),e.jsx("input",{type:"text",placeholder:"Order ID (e.g., ORD123)",className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:_.orderId,onChange:e=>S({..._,orderId:e.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Due Date:"}),e.jsx("input",{type:"date",placeholder:"Due Date",className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:_.dueDate,onChange:e=>S({..._,dueDate:e.target.value})})]}),e.jsx("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md",children:e.jsxs("p",{className:"text-xs text-blue-800 dark:text-blue-200",children:[e.jsx("strong",{children:"Note:"})," GST will be calculated automatically based on product GST rates and customer/merchant state codes."]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Discount Amount (optional):"}),e.jsx("input",{type:"number",placeholder:"Discount Amount",step:"0.01",min:"0",className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:_.discountAmount,onChange:e=>S({..._,discountAmount:parseFloat(e.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Notes (optional):"}),e.jsx("textarea",{placeholder:"Invoice notes",className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:_.notes,onChange:e=>S({..._,notes:e.target.value})})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-6",children:[e.jsx("button",{onClick:()=>f(!1),className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:"Cancel"}),e.jsx("button",{onClick:async()=>{try{const e=await fetch(n("/api/invoices/add-manual"),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(_)});if(e.ok){const t=await e.json();alert(`Invoice created successfully!\nInvoice Number: ${t.invoice.display_number}\nTotal Amount: ${g(t.invoice.total_amount)}`),f(!1),S({orderId:"",dueDate:"",notes:"",discountAmount:0}),J()}else{const t=await e.json();alert(`Failed to create invoice: ${t.message||"Unknown error"}`)}}catch(e){alert("Failed to create invoice: Network error")}},disabled:!_.orderId||!_.dueDate,className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50",children:"Create Invoice"})]})]})}),document.body),I&&O&&a.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-[9999] p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 w-full max-w-md mx-4",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:["Update Invoice: ",O.display_number]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Due Date:"}),e.jsx("input",{type:"date",className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:$.dueDate,onChange:e=>G({...$,dueDate:e.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Payment Status:"}),e.jsxs("select",{className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:$.paymentStatus,onChange:e=>G({...$,paymentStatus:e.target.value}),children:[e.jsx("option",{value:"unpaid",children:"Unpaid"}),e.jsx("option",{value:"paid",children:"Paid"}),e.jsx("option",{value:"partially_paid",children:"Partially Paid"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Payment Method (optional):"}),e.jsxs("select",{className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:$.paymentMethod,onChange:e=>G({...$,paymentMethod:e.target.value}),children:[e.jsx("option",{value:"",children:"Select Payment Method"}),e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"card",children:"Card"}),e.jsx("option",{value:"upi",children:"UPI"}),e.jsx("option",{value:"net_banking",children:"Net Banking"}),e.jsx("option",{value:"wallet",children:"Wallet"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Same payment methods as used in orders"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Discount Amount:"}),e.jsx("input",{type:"number",step:"0.01",min:"0",className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:$.discountAmount,onChange:e=>G({...$,discountAmount:parseFloat(e.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Notes (optional):"}),e.jsx("textarea",{placeholder:"Invoice notes",className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:$.notes,onChange:e=>G({...$,notes:e.target.value})})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx("button",{onClick:()=>T(!1),className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:"Cancel"}),e.jsx("button",{onClick:async()=>{if(O)try{const e=await fetch(`/api/invoices/${O.invoice_id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify($)});if(e.ok)alert("Invoice updated successfully!"),T(!1),P(null),J();else{const t=await e.json();alert(`Failed to update invoice: ${t.message||"Unknown error"}`)}}catch(e){alert("Failed to update invoice: Network error")}},className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Update Invoice"})]})]})}),document.body)]})}export{h as default};
