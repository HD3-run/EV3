import{j as e}from"./framer-motion-CP1hDTrg.js";import{r as t}from"./react-vendor-CFOUl9e9.js";import{b as s,g as r}from"./index-D8_-wRmV.js";import"./lucide-Jis9dCxC.js";function a(){const{user:a}=s(),[d,l]=t.useState([]),[n,i]=t.useState(!0),[o,c]=t.useState(null),[x,m]=t.useState(null),[g]=t.useState(!1),[h,p]=t.useState({totalAssigned:0,completed:0,pending:0,inProgress:0});t.useEffect(()=>{y(),g&&u()},[]);const u=async()=>{try{const e=await fetch(r("/api/orders/debug"),{credentials:"include"});if(e.ok){const t=await e.json();m(t)}}catch(e){}},y=async()=>{try{c(null);const e=await fetch(r("/api/orders?limit=50000&page=1"),{credentials:"include"});if(!e.ok){const t=await e.text();throw c(`API Error: ${e.status} - ${t}`),new Error(`API Error: ${e.status} - ${t}`)}const t=await e.json();if(t.orders&&Array.isArray(t.orders)){const e=t.orders.map(e=>({order_id:e.order_id.toString(),order_number:`ORD${e.order_id}`,customer_name:e.customer_name||"Unknown",customer_phone:e.customer_phone||"N/A",delivery_address:e.customer_address||e.customer_email||"N/A",total_amount:parseFloat(e.total_amount)||0,status:e.status||"pending",assigned_at:e.created_at||(new Date).toISOString()}));l(e),b(e)}else l([]),b([]),t.debug}catch(e){c(e instanceof Error?e.message:"Failed to load orders"),l([]),b([])}finally{i(!1)}},b=e=>{const t={totalAssigned:e.length,completed:e.filter(e=>"delivered"===e.status).length,pending:e.filter(e=>"pending"===e.status).length,inProgress:e.filter(e=>"shipped"===e.status).length};p(t)};return n?e.jsx("div",{className:"p-8 flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading your assigned orders..."})]})}):e.jsxs("div",{className:"p-4 sm:p-6 md:p-8 min-h-screen bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-white",children:[g&&x&&e.jsxs("div",{className:"bg-yellow-100 dark:bg-yellow-900 p-4 rounded-lg mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h3",{className:"font-bold",children:"Debug Information"}),e.jsx("button",{onClick:u,className:"px-3 py-1 bg-blue-500 text-white rounded text-sm hover:bg-blue-600",children:"Refresh Debug Info"})]}),e.jsx("pre",{className:"text-xs bg-white dark:bg-gray-800 p-2 rounded overflow-auto max-h-40",children:JSON.stringify(x,null,2)})]}),o&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("strong",{className:"font-bold",children:"Error Loading Orders:"}),e.jsx("span",{className:"block sm:inline ml-2",children:o})]}),e.jsx("button",{onClick:()=>{c(null),y()},className:"bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600",children:"Retry"})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-2xl sm:text-3xl font-bold",children:["Welcome, ",null==a?void 0:a.username]}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400",children:["Role: ",null==a?void 0:a.role]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700 dark:text-gray-300",children:"Total Assigned"}),e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:h.totalAssigned})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700 dark:text-gray-300",children:"Pending"}),e.jsx("p",{className:"text-3xl font-bold text-yellow-600",children:h.pending})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700 dark:text-gray-300",children:"In Progress"}),e.jsx("p",{className:"text-3xl font-bold text-orange-600",children:h.inProgress})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700 dark:text-gray-300",children:"Completed"}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:h.completed})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow",children:[e.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:e.jsx("h2",{className:"text-xl font-semibold",children:"Current Assigned Orders"})}),0===d.length?e.jsxs("div",{className:"p-8 text-center",children:[e.jsxs("div",{className:"text-gray-500 dark:text-gray-400 mb-4",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No Orders Assigned"}),e.jsx("p",{className:"text-sm mb-4",children:o?"There was an error loading your orders.":"No orders have been assigned to you yet."}),e.jsx("button",{onClick:y,className:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded transition-colors",children:"Refresh Orders"})]}),g&&e.jsxs("div",{className:"mt-4 text-left bg-gray-100 dark:bg-gray-800 p-4 rounded",children:[e.jsx("h4",{className:"font-bold mb-2",children:"Troubleshooting:"}),e.jsxs("ul",{className:"text-sm space-y-1 text-gray-600 dark:text-gray-400",children:[e.jsx("li",{children:"• Check if you are logged in as the correct user"}),e.jsx("li",{children:"• Verify that orders have been assigned to your account"}),e.jsx("li",{children:"• Contact your administrator if the problem persists"})]})]})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Order #"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Customer"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Phone"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Address"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Amount"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:d.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white",children:t.order_number}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:t.customer_name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:t.customer_phone}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500 dark:text-gray-300 max-w-xs truncate",children:t.delivery_address}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:["₹",t.total_amount]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsx("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full "+("delivered"===t.status?"bg-green-100 text-green-800":"shipped"===t.status?"bg-blue-100 text-blue-800":"confirmed"===t.status?"bg-purple-100 text-purple-800":"pending"===t.status?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:t.status})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("select",{value:t.status,onChange:e=>(async(e,t)=>{try{(await fetch(`/api/employee/orders/${e}/status`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({status:t})})).ok&&y()}catch(s){}})(t.order_id,e.target.value),className:"text-sm border border-gray-300 dark:border-gray-600 rounded px-2 py-1 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"confirmed",children:"Confirmed"}),e.jsx("option",{value:"shipped",children:"Shipped"}),e.jsx("option",{value:"delivered",children:"Delivered"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})})]},t.order_id))})]})})]})]})}export{a as default};
