import{j as e}from"./framer-motion-CP1hDTrg.js";import{r as a}from"./react-vendor-CFOUl9e9.js";import{b as t,a as r,g as s}from"./index-D8_-wRmV.js";import"./lucide-Jis9dCxC.js";function l(){const{user:l}=t();r();const d=null==l?void 0:l.role,[i,n]=a.useState({name:"",email:"",phone:""}),[o,c]=a.useState(""),[g,m]=a.useState(""),[x,b]=a.useState(""),[u,h]=a.useState([]),[p,y]=a.useState(""),[k,f]=a.useState(!1),[j,w]=a.useState([]),[v,N]=a.useState(!1),[_,A]=a.useState(!1),[S,C]=a.useState({username:"",email:"",phone:"",role:"",password:""}),[P,D]=a.useState({gst_number:"",pan_number:"",billing_address_line1:"",billing_address_line2:"",billing_city:"",billing_state:"",billing_pincode:"",billing_country:"India",bank_name:"",bank_account_number:"",ifsc_code:"",invoice_logo_url:"",invoice_prefix:"INV-",state_code:"19"}),[F,T]=a.useState(!1),[L,I]=a.useState(!1),[B,O]=a.useState(!1),[U,$]=a.useState(""),[q,E]=a.useState("");a.useEffect(()=>{(async()=>{try{const e=await fetch(s("/api/profile"),{credentials:"include"});if(e.ok){const a=await e.json();n({name:a.username||"",email:a.email||"",phone:a.phone||""})}}catch(e){y("Failed to load profile data")}})(),"admin"===d&&(M(),G())},[d]);const M=async()=>{try{const e=await fetch(s("/api/users"),{credentials:"include"});if(e.ok){const a=await e.json();w(a.users||[])}}catch(e){y("Failed to load users")}},G=async()=>{try{const e=await fetch(s("/api/billing-details"),{credentials:"include"});if(e.ok){const a=await e.json();a.billingDetails&&D({gst_number:a.billingDetails.gst_number||"",pan_number:a.billingDetails.pan_number||"",billing_address_line1:a.billingDetails.billing_address_line1||"",billing_address_line2:a.billingDetails.billing_address_line2||"",billing_city:a.billingDetails.billing_city||"",billing_state:a.billingDetails.billing_state||"",billing_pincode:a.billingDetails.billing_pincode||"",billing_country:a.billingDetails.billing_country||"India",bank_name:a.billingDetails.bank_name||"",bank_account_number:a.billingDetails.bank_account_number||"",ifsc_code:a.billingDetails.ifsc_code||"",invoice_logo_url:a.billingDetails.invoice_logo_url||"",invoice_prefix:a.billingDetails.invoice_prefix||"INV-",state_code:a.billingDetails.state_code||"19"})}}catch(e){y("Failed to load billing details")}},R=async(e,a)=>{f(!0);try{const t=await fetch(`/api/users/${e}/role`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({role:a})});if(t.ok)y("Role updated successfully!"),M();else{const e=await t.json();y(e.message||"Failed to update role")}}catch(t){y("Failed to update role")}finally{f(!1),setTimeout(()=>y(""),3e3)}},J=e=>{const{name:a,value:t}=e.target;D(e=>({...e,[a]:t})),U&&($(""),E("")),"billing_pincode"===a&&6===t.length&&V(t)},V=async e=>{if(6===e.length){O(!0);try{const a=await fetch(`https://api.postalpincode.in/pincode/${e}`),t=await a.json();if(t&&t[0]&&"Success"===t[0].Status&&t[0].PostOffice&&t[0].PostOffice.length>0){const e=t[0].PostOffice[0];let a="";e.Name&&e.Name!==e.District?a=e.Name:e.Block&&e.Block!==e.District?a=e.Block:e.Division&&e.Division!==e.District&&(a=e.Division),D(t=>({...t,billing_city:e.District||t.billing_city,billing_state:e.State||t.billing_state,billing_country:"India",billing_address_line1:a||t.billing_address_line1}))}}catch(a){}finally{O(!1)}}},W=e=>{const{name:a,value:t}=e.target;if("phone"===a){const e=t.replace(/\D/g,"");n(t=>({...t,[a]:e}))}else n(e=>({...e,[a]:t}))};return e.jsxs("div",{className:"p-4 sm:p-6 md:p-8 min-h-screen bg-light-pink dark:bg-gray-900 text-gray-900 dark:text-white",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold mb-6",children:"admin"===d?"Merchant Profile / Settings":"User Profile / Settings"}),p&&e.jsx("div",{className:"bg-blue-100 text-blue-800 p-3 rounded-md mb-4",children:p}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 sm:gap-8",children:[e.jsxs("div",{className:"bg-light-pink-100 dark:bg-gray-800 p-4 sm:p-6 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-semibold mb-4",children:"Edit Profile"}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault();if(!i.phone||/^[0-9]{10}$/.test(i.phone)){f(!0);try{const e=await fetch(s("/api/profile"),{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(i)});if(e.ok)y("Profile updated successfully!");else{const a=await e.json();y(a.message||"Failed to update profile")}}catch(a){y("Failed to update profile")}finally{f(!1),setTimeout(()=>y(""),3e3)}}else y("Phone number must be exactly 10 digits")},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Name"}),e.jsx("input",{type:"text",id:"name",name:"name",value:i.name,onChange:W,className:"mt-1 block w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Email"}),e.jsx("input",{type:"email",id:"email",name:"email",value:i.email,onChange:W,className:"mt-1 block w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Phone"}),e.jsx("input",{type:"tel",id:"phone",name:"phone",value:i.phone,onChange:W,inputMode:"numeric",pattern:"[0-9]*",maxLength:10,placeholder:"Enter phone number",className:"mt-1 block w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white"})]}),e.jsx("button",{type:"submit",disabled:k,className:"px-4 py-2 rounded-md bg-blue-500 text-white hover:bg-blue-600 disabled:opacity-50",children:k?"Saving...":"Save Profile"})]})]}),e.jsxs("div",{className:"bg-light-pink-100 dark:bg-gray-800 p-4 sm:p-6 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-semibold mb-4",children:"Change Password"}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault();const a=(e=>{const a=[];return e.length<8&&a.push("Password must be at least 8 characters"),/[A-Z]/.test(e)||a.push("Password must contain uppercase letter"),/[a-z]/.test(e)||a.push("Password must contain lowercase letter"),/\d/.test(e)||a.push("Password must contain number"),/[!@#$%^&*]/.test(e)||a.push("Password must contain special character (!@#$%^&*)"),a})(g);if(a.length>0)return h(a),void y("Password requirements not met");if(g!==x)return y("New passwords do not match."),void h([]);h([]),f(!0);try{const e=await fetch(s("/api/profile/password"),{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({currentPassword:o,newPassword:g})});if(e.ok)y("Password changed successfully!"),c(""),m(""),b("");else{const a=await e.json();y(a.message||"Failed to change password")}}catch(t){y("Failed to change password")}finally{f(!1),setTimeout(()=>y(""),3e3)}},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"currentPassword",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Current Password"}),e.jsx("input",{type:"password",id:"currentPassword",value:o,onChange:e=>c(e.target.value),className:"mt-1 block w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"newPassword",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"New Password"}),e.jsx("input",{type:"password",id:"newPassword",value:g,onChange:e=>m(e.target.value),className:"mt-1 block w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white"}),e.jsxs("div",{className:"mt-2 text-xs text-gray-600 dark:text-gray-400",children:[e.jsx("p",{className:"font-medium mb-1",children:"Password requirements:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-0.5",children:[e.jsx("li",{children:"Minimum 8 characters"}),e.jsx("li",{children:"At least 1 uppercase letter"}),e.jsx("li",{children:"At least 1 lowercase letter"}),e.jsx("li",{children:"At least 1 number"}),e.jsx("li",{children:"At least 1 special character (!@#$%^&*)"})]})]}),u.length>0&&e.jsx("div",{className:"mt-2 text-xs text-red-600 dark:text-red-400",children:u.map((a,t)=>e.jsxs("p",{children:["â€¢ ",a]},t))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmNewPassword",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Confirm New Password"}),e.jsx("input",{type:"password",id:"confirmNewPassword",value:x,onChange:e=>b(e.target.value),className:"mt-1 block w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white"})]}),e.jsx("button",{type:"submit",disabled:k,className:"px-4 py-2 rounded-md bg-blue-500 text-white hover:bg-blue-600 disabled:opacity-50",children:k?"Changing...":"Change Password"})]})]}),"admin"===d&&e.jsxs("div",{className:"bg-light-pink-100 dark:bg-gray-800 p-4 sm:p-6 rounded-lg shadow-md col-span-full",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-semibold mb-4",children:"Billing Details"}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 mb-4",children:"Configure your business billing information for invoice generation."}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 mb-6",children:[e.jsx("h4",{className:"text-sm font-semibold text-blue-800 dark:text-blue-200 mb-2",children:"ðŸ’¡ Smart Address Features:"}),e.jsxs("ul",{className:"text-xs text-blue-700 dark:text-blue-300 space-y-1",children:[e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"ðŸ“ Use Current Location:"})," Auto-detect complete address including street, pincode, city, and state"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"ðŸ”¢ Enter Pincode:"})," Auto-fill complete address including area, city, and state from Indian postal codes"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"âœ… Real Validation:"})," Only valid Indian addresses are accepted"]})]})]}),U&&e.jsx("div",{className:"p-4 rounded-lg mb-6 "+("success"===q?"bg-green-100 border border-green-300 text-green-800 dark:bg-green-900/20 dark:border-green-800 dark:text-green-200":"bg-red-100 border border-red-300 text-red-800 dark:bg-red-900/20 dark:border-red-800 dark:text-red-200"),children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:"success"===q?e.jsx("span",{className:"text-green-500 text-xl",children:"âœ…"}):e.jsx("span",{className:"text-red-500 text-xl",children:"âŒ"})}),e.jsx("div",{className:"ml-3 flex-1",children:e.jsx("pre",{className:"whitespace-pre-wrap text-sm font-medium",children:U})}),e.jsx("div",{className:"flex-shrink-0 ml-3",children:e.jsxs("button",{type:"button",onClick:()=>{$(""),E("")},className:"inline-flex rounded-md p-1.5 "+("success"===q?"text-green-500 hover:bg-green-200 dark:hover:bg-green-800":"text-red-500 hover:bg-red-200 dark:hover:bg-red-800"),children:[e.jsx("span",{className:"sr-only",children:"Dismiss"}),e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})})]})}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),$(""),E(""),T(!0);try{const e=await fetch(s("/api/billing-details"),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(P)});if(e.ok){await e.json();$("ðŸŽ‰ Billing details saved successfully! Your invoice settings are now configured."),E("success"),y("Billing details saved successfully!")}else{const a=await e.json();let t="Failed to save billing details";a.message&&(t=`âŒ ${a.message}`,a.message.includes("GST number format")?t+="\n\nðŸ’¡ Tip: GST number should be 15 characters like: 22AAAAA0000A1Z5":a.message.includes("PAN number format")?t+="\n\nðŸ’¡ Tip: PAN number should be 10 characters like: AAAAA0000A":a.message.includes("IFSC code format")?t+="\n\nðŸ’¡ Tip: IFSC code should be 11 characters like: SBIN0001234":a.message.includes("required")&&(t+="\n\nðŸ’¡ Tip: Please fill in all required fields (Address Line 1, City, State, Pincode)")),$(t),E("error"),y(a.message||"Failed to save billing details")}}catch(a){$("âŒ Network error: Unable to connect to server. Please check your internet connection and try again."),E("error"),y("Failed to save billing details")}finally{T(!1),setTimeout(()=>{$(""),E(""),y("")},5e3)}},className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"GST Number (Optional)"}),e.jsx("input",{type:"text",name:"gst_number",value:P.gst_number,onChange:J,placeholder:"22AAAAA0000A1Z5",maxLength:15,className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"15-character GST number (e.g., 22AAAAA0000A1Z5)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"PAN Number (Optional)"}),e.jsx("input",{type:"text",name:"pan_number",value:P.pan_number,onChange:J,placeholder:"AAAAA0000A",maxLength:10,className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"10-character PAN number (e.g., AAAAA0000A)"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h3",{className:"text-md font-semibold text-gray-700 dark:text-gray-300",children:"Billing Address"}),e.jsx("button",{type:"button",onClick:()=>{navigator.geolocation?(I(!0),navigator.geolocation.getCurrentPosition(async e=>{var a,t,r,s,l,d,i,n,o;try{const{latitude:c,longitude:g}=e.coords,[m,x]=await Promise.allSettled([fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${c}&longitude=${g}&localityLanguage=en`),fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${c}&lon=${g}&addressdetails=1&accept-language=en`)]);let b={},u={};if("fulfilled"===m.status&&m.value.ok){const e=await m.value.json();b={city:e.locality,state:e.principalSubdivision,country:e.countryName,pincode:e.postcode}}if("fulfilled"===x.status&&x.value.ok){const e=await x.value.json();u={address:e.display_name,houseNumber:(null==(a=e.address)?void 0:a.house_number)||"",road:(null==(t=e.address)?void 0:t.road)||"",suburb:(null==(r=e.address)?void 0:r.suburb)||"",postcode:(null==(s=e.address)?void 0:s.postcode)||"",city:(null==(l=e.address)?void 0:l.city)||(null==(d=e.address)?void 0:d.town)||(null==(i=e.address)?void 0:i.village),state:null==(n=e.address)?void 0:n.state,country:null==(o=e.address)?void 0:o.country}}const h={billing_city:b.city||u.city||"",billing_state:b.state||u.state||"",billing_country:b.country||u.country||"India",billing_pincode:b.pincode||u.postcode||"",billing_address_line1:u.road?`${u.houseNumber?u.houseNumber+", ":""}${u.road}`.trim():u.suburb||""};h.billing_city||h.billing_state?(D(e=>({...e,...h})),h.billing_pincode&&6===h.billing_pincode.length&&V(h.billing_pincode)):y("Could not determine address from current location")}catch(c){y("Failed to get address from location")}finally{I(!1)}},e=>{y("Failed to get current location"),I(!1)})):y("Geolocation is not supported by this browser")},disabled:L,className:"px-3 py-1 text-sm bg-green-500 text-white rounded-md hover:bg-green-600 disabled:opacity-50 flex items-center gap-1",children:L?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Detecting..."]}):e.jsx(e.Fragment,{children:"ðŸ“ Use Current Location"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Address Line 1 *"}),e.jsx("input",{type:"text",name:"billing_address_line1",value:P.billing_address_line1,onChange:J,placeholder:"Street address, building name",required:!0,className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Address Line 2 (Optional)"}),e.jsx("input",{type:"text",name:"billing_address_line2",value:P.billing_address_line2,onChange:J,placeholder:"Apartment, suite, unit, etc.",className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"City *"}),e.jsx("input",{type:"text",name:"billing_city",value:P.billing_city,onChange:J,placeholder:"City",required:!0,className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"State *"}),e.jsx("input",{type:"text",name:"billing_state",value:P.billing_state,onChange:J,placeholder:"State",required:!0,className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"State Code *"}),e.jsx("input",{type:"text",name:"state_code",value:P.state_code,onChange:J,placeholder:"19",maxLength:2,required:!0,className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"2-digit state code (e.g., 19 for West Bengal)"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["Pincode *",B&&e.jsxs("span",{className:"ml-2 text-xs text-blue-500 flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),"Auto-filling..."]})]}),e.jsx("input",{type:"text",name:"billing_pincode",value:P.billing_pincode,onChange:J,placeholder:"123456",maxLength:6,required:!0,className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Enter 6-digit pincode to auto-fill city & state"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Country"}),e.jsx("input",{type:"text",name:"billing_country",value:P.billing_country,onChange:J,className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-semibold text-gray-700 dark:text-gray-300 mb-3",children:"Bank Details (Optional)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Bank Name"}),e.jsx("input",{type:"text",name:"bank_name",value:P.bank_name,onChange:J,placeholder:"Bank name",className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Account Number"}),e.jsx("input",{type:"text",name:"bank_account_number",value:P.bank_account_number,onChange:J,placeholder:"Account number",className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"IFSC Code"}),e.jsx("input",{type:"text",name:"ifsc_code",value:P.ifsc_code,onChange:J,placeholder:"SBIN0001234",maxLength:11,className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"11-character IFSC code (e.g., SBIN0001234)"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-semibold text-gray-700 dark:text-gray-300 mb-3",children:"Invoice Settings"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Invoice Prefix"}),e.jsx("input",{type:"text",name:"invoice_prefix",value:P.invoice_prefix,onChange:J,placeholder:"INV-",className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Prefix for invoice numbers (e.g., INV-, BILL-, etc.)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Logo URL (Optional) - Supported formats: PNG, JPG, and WebP"}),e.jsx("input",{type:"url",name:"invoice_logo_url",value:P.invoice_logo_url,onChange:J,placeholder:"https://example.com/logo.png",className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"URL to your company logo for invoices (PNG, JPG, or WebP format)"})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",disabled:F,className:"px-6 py-2 rounded-md bg-blue-500 text-white hover:bg-blue-600 disabled:opacity-50 flex items-center gap-2",children:F?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Saving..."]}):e.jsx(e.Fragment,{children:"ðŸ’¾ Save Billing Details"})})})]})]}),"admin"===d&&e.jsxs("div",{className:"bg-light-pink-100 dark:bg-gray-800 p-4 sm:p-6 rounded-lg shadow-md col-span-full",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-semibold mb-4",children:"User Management"}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 mb-4",children:"Manage employees like pickup staff, managers, and other team members."}),e.jsxs("div",{className:"mb-4",children:[e.jsx("button",{onClick:()=>N(!v),className:"px-4 py-2 rounded-md bg-green-500 text-white hover:bg-green-600 mr-2",children:"Add User"}),e.jsx("button",{onClick:()=>A(!_),className:"px-4 py-2 rounded-md bg-yellow-500 text-white hover:bg-yellow-600 mr-2",children:"Manage Roles"})]}),v&&e.jsxs("div",{className:"mb-6 p-4 border border-gray-300 dark:border-gray-600 rounded-md",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Add New User"}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault();if(!S.phone||/^[0-9]{10}$/.test(S.phone)){f(!0);try{const e=await fetch(s("/api/users"),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(S)});if(e.ok)y("User added successfully!"),C({username:"",email:"",phone:"",role:"",password:""}),N(!1),M();else{const a=await e.json();y(a.message||"Failed to add user")}}catch(a){y("Failed to add user")}finally{f(!1),setTimeout(()=>y(""),3e3)}}else y("Phone number must be exactly 10 digits")},className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Username"}),e.jsx("input",{type:"text",value:S.username,onChange:e=>C({...S,username:e.target.value}),className:"mt-1 block w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Email"}),e.jsx("input",{type:"email",value:S.email,onChange:e=>C({...S,email:e.target.value}),className:"mt-1 block w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Phone"}),e.jsx("input",{type:"tel",value:S.phone,onChange:e=>{const a=e.target.value.replace(/\D/g,"");C({...S,phone:a})},inputMode:"numeric",pattern:"[0-9]*",maxLength:10,placeholder:"Enter phone number",className:"mt-1 block w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Role"}),e.jsx("input",{type:"text",value:S.role,onChange:e=>C({...S,role:e.target.value}),placeholder:"e.g., Pickup Staff, Manager, Delivery Boy",className:"mt-1 block w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Password"}),e.jsx("input",{type:"password",value:S.password,onChange:e=>C({...S,password:e.target.value}),placeholder:"Set password for this user",className:"mt-1 block w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white",required:!0})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("button",{type:"submit",disabled:k,className:"px-4 py-2 rounded-md bg-blue-500 text-white hover:bg-blue-600 disabled:opacity-50 mr-2",children:k?"Adding...":"Add User"}),e.jsx("button",{type:"button",onClick:()=>N(!1),className:"px-4 py-2 rounded-md bg-gray-500 text-white hover:bg-gray-600",children:"Cancel"})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Role"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-light-pink-100 dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:j.map(a=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white",children:a.username}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:a.email}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:_?e.jsx("input",{type:"text",value:a.role||"",onChange:e=>R(a.user_id,e.target.value),onBlur:e=>R(a.user_id,e.target.value),className:"p-1 border border-gray-300 dark:border-gray-600 rounded bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"Enter role name"}):e.jsx("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full "+("admin"===a.role?"bg-purple-100 text-purple-800":"manager"===a.role?"bg-blue-100 text-blue-800":"pickup"===a.role?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:a.role||"employee"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:"admin"!==a.role&&e.jsx("button",{onClick:()=>(async e=>{if(confirm("Are you sure you want to remove this user?")){f(!0);try{const a=await fetch(`/api/users/${e}`,{method:"DELETE",credentials:"include"});if(a.ok)y("User removed successfully!"),M();else{const e=await a.json();y(e.message||"Failed to remove user")}}catch(a){y("Failed to remove user")}finally{f(!1),setTimeout(()=>y(""),3e3)}}})(a.user_id),className:"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-200",children:"Remove"})})]},a.user_id))})]})})]})]})]})}export{l as default};
