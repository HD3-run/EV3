import{j as e}from"./framer-motion-CP1hDTrg.js";import{r as t}from"./react-vendor-CFOUl9e9.js";import{g as r}from"./index-D8_-wRmV.js";import"./lucide-Jis9dCxC.js";function s(){const[s,a]=t.useState([]),[d,n]=t.useState(!0),[l,i]=t.useState(null),[o,c]=t.useState("all"),[x,p]=t.useState("");t.useEffect(()=>{m()},[]);const m=async()=>{try{i(null);const e=await fetch(r("/api/orders?limit=50000&page=1"),{credentials:"include"});if(!e.ok){const t=await e.text();return i(`Failed to load orders: ${e.status} - ${t}`),void a([])}const t=await e.json();if(t.orders&&Array.isArray(t.orders)){const e=t.orders.map(e=>({id:e.order_id.toString(),orderId:`ORD${e.order_id}`,customerName:e.customer_name||"Unknown",amount:parseFloat(e.total_amount)||0,status:e.status||"pending",date:new Date(e.order_date||e.created_at).toISOString().split("T")[0],channel:e.order_source||"Unknown",type:"Standard",customer:e.customer_name||"Unknown"}));a(e)}else a([]),t.debug}catch(e){i(e instanceof Error?e.message:"Failed to load orders"),a([])}finally{n(!1)}},u=s.filter(e=>{const t=e.customerName.toLowerCase().includes(x.toLowerCase())||e.orderId.toLowerCase().includes(x.toLowerCase()),r="all"===o||e.status===o;return t&&r});return d?e.jsxs("div",{className:"p-4 sm:p-6 md:p-8 min-h-screen bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-white",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold mb-6",children:"My Orders"}),e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-400",children:"Loading your orders..."})]})})]}):e.jsxs("div",{className:"p-4 sm:p-6 md:p-8 min-h-screen bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-white",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold mb-6",children:"My Orders"}),l&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("strong",{className:"font-bold",children:"Error Loading Orders:"}),e.jsx("span",{className:"block sm:inline ml-2",children:l})]}),e.jsx("button",{onClick:()=>{i(null),m()},className:"bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600",children:"Retry"})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center mb-6 space-y-4 sm:space-y-0 sm:space-x-4",children:[e.jsx("input",{type:"text",placeholder:"Search by customer or order ID...",className:"p-2 border border-gray-300 dark:border-gray-700 rounded-md w-full sm:w-auto bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:x,onChange:e=>p(e.target.value)}),e.jsxs("select",{className:"p-2 border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:o,onChange:e=>c(e.target.value),children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"confirmed",children:"Confirmed"}),e.jsx("option",{value:"processing",children:"Processing"}),e.jsx("option",{value:"shipped",children:"Shipped"}),e.jsx("option",{value:"delivered",children:"Delivered"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]}),e.jsx("div",{className:"overflow-x-auto bg-white dark:bg-gray-800 rounded-lg shadow",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Order ID"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Customer Name"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Channel"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Status"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Amount"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Date"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:0===u.length?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-6 py-12 text-center",children:e.jsxs("div",{className:"text-gray-500 dark:text-gray-400",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:x||"all"!==o?"No Matching Orders":"No Orders Assigned"}),e.jsx("p",{className:"text-sm mb-4",children:x||"all"!==o?"Try adjusting your search or filter criteria.":l?"There was an error loading your orders.":"No orders have been assigned to you yet. Contact your admin to assign orders."}),!x&&"all"===o&&e.jsx("button",{onClick:m,className:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded transition-colors",children:"Refresh Orders"})]})})}):u.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white",children:t.orderId}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:t.customerName}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:t.channel}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsx("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full "+("delivered"===t.status?"bg-green-100 text-green-800":"shipped"===t.status?"bg-blue-100 text-blue-800":"processing"===t.status?"bg-indigo-100 text-indigo-800":"confirmed"===t.status?"bg-purple-100 text-purple-800":"pending"===t.status?"bg-yellow-100 text-yellow-800":"returned"===t.status?"bg-gray-100 text-gray-800":"bg-red-100 text-red-800"),children:t.status})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:["$",t.amount.toFixed(2)]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:t.date}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[e.jsxs("select",{value:t.status,onChange:e=>(async(e,t)=>{try{const r=await fetch(`/api/employee/orders/${e}/status`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({status:t})});if(r.ok)a(r=>r.map(r=>r.id===e?{...r,status:t}:r));else{const e=await r.json();alert(e.message)}}catch(r){alert("Network error occurred")}})(t.id,e.target.value),className:"text-sm border border-gray-300 dark:border-gray-600 rounded px-2 py-1 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",disabled:"delivered"===t.status||"cancelled"===t.status||"returned"===t.status,children:[e.jsx("option",{value:t.status,children:t.status.charAt(0).toUpperCase()+t.status.slice(1)}),"pending"===t.status&&e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"confirmed",children:"Confirmed"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]}),"confirmed"===t.status&&e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"processing",children:"Processing"}),e.jsx("option",{value:"shipped",children:"Shipped"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]}),"processing"===t.status&&e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"shipped",children:"Shipped"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]}),"shipped"===t.status&&e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"delivered",children:"Delivered"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]}),("delivered"===t.status||"cancelled"===t.status)&&e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 block mt-1",children:"Final status"}),"returned"===t.status&&e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 block mt-1",children:"Admin only"})]})]},t.id))})]})})]})}export{s as default};
