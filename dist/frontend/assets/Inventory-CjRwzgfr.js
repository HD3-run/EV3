import{j as e}from"./framer-motion-CP1hDTrg.js";import{r as t,a as r}from"./react-vendor-CFOUl9e9.js";import{F as a}from"./FileUpload-DdCe1LmD.js";import{D as s,E as d,a as o,u as n,w as l}from"./jspdf.plugin.autotable-BWxvZjXE.js";import{b as i,a as c,c as x,g as m}from"./index-Zg8dsWBS.js";import{f as u}from"./currency-CLTscsdx.js";import{L as g}from"./Layout-D0rQz-4W.js";import"./lucide-Jis9dCxC.js";import"./Footer-D5Bc2McR.js";const h=e=>{if(!e||e.length<4)return null;return{"0401":0,"0402":5,1001:0,1006:0,1701:5,2106:12,3004:12,6109:5,6203:5,6204:5,8471:18,8517:18,8528:28,8703:28,9403:18}[e.substring(0,4)]??null},p=t.memo(({product:t,userRole:r,editingPrice:a,setEditingPrice:s,handlePriceEdit:d,handlePriceSave:o,handlePriceCancel:n,setManualUpdateProduct:l,setShowManualUpdateModal:i,expandedProducts:c,toggleProductExpansion:x})=>e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 text-sm font-medium text-gray-900 dark:text-white",children:e.jsx("div",{className:"max-w-xs truncate",title:t.product_name,children:t.product_name})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500 dark:text-gray-300",children:e.jsx("div",{className:"max-w-xs truncate",title:t.category||"Uncategorized",children:t.category||"Uncategorized"})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500 dark:text-gray-300 text-right",children:"admin"===r?(null==a?void 0:a.productId)===t.product_id?e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsx("input",{type:"number",step:"0.01",min:"0",value:(null==a?void 0:a.value)||"",onChange:e=>s({...a,value:e.target.value}),className:"w-20 px-2 py-1 text-xs border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-right",autoFocus:!0}),e.jsx("button",{onClick:()=>o(t.product_id),className:"text-green-600 hover:text-green-800 text-xs",children:"✓"}),e.jsx("button",{onClick:n,className:"text-red-600 hover:text-red-800 text-xs",children:"✕"})]}):e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsx("span",{className:"font-mono",children:t.unit_price&&t.unit_price>0?u(t.unit_price):e.jsx("span",{className:"text-gray-400 italic",children:"Not set"})}),e.jsx("button",{onClick:()=>d(t.product_id,t.unit_price||0),className:"text-blue-600 hover:text-blue-800 text-xs",title:"Edit price",children:"✏️"})]}):e.jsx("span",{className:"font-mono",children:t.unit_price&&t.unit_price>0?u(t.unit_price):e.jsx("span",{className:"text-gray-400 italic",children:"Not set"})})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500 dark:text-gray-300 text-right",children:e.jsx("span",{className:"font-mono font-medium",children:t.quantity_available||0})}),e.jsx("td",{className:"px-6 py-4 text-sm text-center",children:e.jsx("span",{className:"px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full "+(t.is_low_stock?"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200":"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200"),children:t.is_low_stock?"Low Stock":"In Stock"})}),e.jsx("td",{className:"px-6 py-4 text-sm text-center",children:e.jsx("button",{onClick:()=>x(t.product_id),className:"text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-200 text-sm font-medium px-3 py-1 rounded border border-blue-300 hover:bg-blue-50 dark:hover:bg-blue-900 transition-colors",children:c.has(t.product_id)?"View Less":"View More"})}),e.jsx("td",{className:"px-6 py-4 text-sm text-center",children:"admin"===r&&e.jsx("button",{onClick:()=>{l({productId:t.product_id,productName:t.product_name,sku:t.sku,brand:t.brand||"",description:t.description||"",stock:t.quantity_available||0,reorderLevel:t.reorder_level||0,hsn_code:t.hsn_code||"",gst_rate:t.gst_rate||18}),i(!0)},className:"text-indigo-600 hover:text-indigo-900 text-xs font-medium px-3 py-1 rounded border border-indigo-300 hover:bg-indigo-50 dark:hover:bg-indigo-900 transition-colors",children:"Update"})})]}),c.has(t.product_id)&&e.jsx("tr",{className:"bg-gray-50 dark:bg-gray-700 relative z-10",children:e.jsx("td",{colSpan:7,className:"px-6 py-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Product ID"}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-white font-mono",children:t.product_id})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"SKU"}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-white font-mono",children:t.sku})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Merchant ID"}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-white font-mono",children:t.merchant_id})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Product Name"}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:t.product_name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Category"}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:t.category||"Uncategorized"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Brand"}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:t.brand||"Not specified"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Reorder Level"}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-white font-mono",children:t.reorder_level||0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"HSN Code"}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-white font-mono",children:t.hsn_code||"Not set"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"GST Rate"}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:t.gst_rate?`${t.gst_rate}%`:"Not set"})]}),e.jsxs("div",{className:"md:col-span-2 lg:col-span-3",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Description"}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:t.description||"No description available"})]})]})})})]})),y=()=>{const[y,b]=t.useState([]),[k,v]=t.useState(0),[j,w]=t.useState(!0),[N,f]=t.useState(""),[_,S]=t.useState("all"),[C,P]=t.useState("all"),[L,I]=t.useState(!1),[U,T]=t.useState({name:"",category:"",brand:"",description:"",stock:0,reorderLevel:0,unitPrice:0,hsn_code:"",gst_rate:18}),[$,M]=t.useState(!1),[D,E]=t.useState({productId:0,productName:"",sku:"",brand:"",description:"",stock:0,reorderLevel:0,hsn_code:"",gst_rate:18}),[F,q]=t.useState(null),[z,R]=t.useState(null),[A,G]=t.useState(null),[O,B]=t.useState(null),[V,H]=t.useState(()=>{const e=localStorage.getItem("inventory-processing-errors");return e?JSON.parse(e):[]}),[K,Q]=t.useState(!1),[W,J]=t.useState(new Set),Y=e=>{H(e),e.length>0?localStorage.setItem("inventory-processing-errors",JSON.stringify(e)):localStorage.removeItem("inventory-processing-errors")},X=e=>{J(t=>{const r=new Set(t);return r.has(e)?r.delete(e):r.add(e),r})},[Z,ee]=t.useState(1),[te]=t.useState(50),re=y,ae=t.useMemo(()=>[...new Set(y.map(e=>e.category).filter(Boolean))],[y]),se=Math.ceil(k/te),de=y;t.useEffect(()=>{ee(1),me(1)},[N,_,C]);const{user:oe}=i();c();const{isConnected:ne}=x(),le=(null==oe?void 0:oe.role)||"admin",ie=t.useCallback((e,t)=>{q({productId:e,value:(null==t?void 0:t.toString())||"0"})},[]),ce=t.useCallback(async e=>{if(!F)return;const t=parseFloat(F.value);if(isNaN(t)||t<0)alert("Please enter a valid price");else try{(await fetch(`/api/inventory/${e}/price`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({unitPrice:t})})).ok?(b(r=>r.map(r=>r.product_id===e?{...r,unit_price:t}:r)),q(null)):alert("Failed to update price")}catch(r){alert("Failed to update price")}},[F]),xe=t.useCallback(()=>{q(null)},[]);t.useEffect(()=>{const e=new URLSearchParams(window.location.search).get("stockStatus");e&&["all","in","low"].includes(e)?(P(e),me(1,e)):me()},[]);const me=async(e=Z,t)=>{try{const r=new URLSearchParams({limit:"50",page:e.toString()});N&&r.append("search",N),_&&"all"!==_&&r.append("category",_);const a=t||C;a&&"all"!==a&&r.append("stockStatus",a);const s=await fetch(`/api/inventory?${r.toString()}`,{credentials:"include"});if(s.ok){const e=await s.json(),t=(e.products||[]).map(e=>({...e,product_name:e.product_name||e.name||"",sku:e.sku||"",category:e.category||"",quantity_available:e.quantity_available||0,reorder_level:e.reorder_level||0,is_low_stock:e.is_low_stock||!1,unit_price:e.unit_price||0}));b(t),e.pagination&&e.pagination.total&&v(e.pagination.total),w(!1)}else w(!1)}catch(r){w(!1)}},[ue,ge]=t.useState(0),[he,pe]=t.useState(0),ye=async()=>{try{const e=await fetch(m("/api/inventory?limit=50000&page=1"),{credentials:"include"});if(e.ok){const t=await e.json();if(t.products&&Array.isArray(t.products)){const e=t.products.map(e=>({...e,product_name:e.product_name||e.name||"",sku:e.sku||"",category:e.category||"",quantity_available:e.quantity_available||0,reorder_level:e.reorder_level||0,is_low_stock:e.is_low_stock||!1,unit_price:e.unit_price||0})),r=e.reduce((e,t)=>e+(t.quantity_available||0),0),a=e.filter(e=>e.is_low_stock).length;ge(r),pe(a)}}}catch(e){}};return t.useEffect(()=>{ye()},[]),t.useEffect(()=>{if(!ne)return;const e=e=>{e.productId&&(b(t=>t.map(t=>t.product_id===e.productId?{...t,...void 0!==e.quantity&&{quantity_available:e.quantity},...e.productName&&{product_name:e.productName},...void 0!==e.brand&&{brand:e.brand},...void 0!==e.description&&{description:e.description},...void 0!==e.reorderLevel&&{reorder_level:e.reorderLevel},...void 0!==e.unitPrice&&{unit_price:e.unitPrice},...void 0!==e.hsn_code&&{hsn_code:e.hsn_code},...void 0!==e.gst_rate&&{gst_rate:e.gst_rate}}:t)),void 0!==e.quantity&&ge(t=>{const r=y.find(t=>t.product_id===e.productId);return t-((null==r?void 0:r.quantity_available)||0)+e.quantity}),setTimeout(()=>{ye()},1e3))},t=e=>{const t={product_id:e.productId,product_name:e.productName,sku:e.sku,category:e.category||"",brand:e.brand||"",description:e.description||"",quantity_available:e.stock||0,reorder_level:e.reorderLevel||0,unit_price:e.unitPrice||0,is_low_stock:(e.stock||0)<=(e.reorderLevel||0),merchant_id:0};b(e=>[t,...e]),v(e=>e+1),ge(t=>t+(e.stock||0)),t.is_low_stock&&pe(e=>e+1),setTimeout(()=>{ye()},1e3)},r=e=>{e.productId&&void 0!==e.unitPrice&&b(t=>t.map(t=>t.product_id===e.productId?{...t,unit_price:e.unitPrice}:t))},a=window.io;return a&&a.connected?(a.on("inventory-updated",e),a.on("inventory-product-added",t),a.on("inventory-price-updated",r),a.on("inventory-stock-updated",e),()=>{a.off("inventory-updated",e),a.off("inventory-product-added",t),a.off("inventory-price-updated",r),a.off("inventory-stock-updated",e)}):void 0},[ne,y]),t.useEffect(()=>{const e=()=>{ye()};return window.addEventListener("focus",e),()=>window.removeEventListener("focus",e)},[]),j?e.jsxs(g,{children:[e.jsx("h1",{className:"text-3xl font-bold heading-gradient mb-6",children:"Inventory"}),e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"text-lg text-slate-300",children:"Loading inventory..."})})]}):e.jsxs(g,{children:[e.jsx("h1",{className:"text-3xl font-bold heading-gradient mb-6",children:"Inventory"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-slate-800/50 p-6 rounded-lg",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-300 mb-3",children:"Total Products"}),e.jsx("p",{className:"text-4xl font-bold text-white",children:k})]}),e.jsxs("div",{className:"bg-slate-800/50 p-6 rounded-lg",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-300 mb-3",children:"Total Stock"}),e.jsx("p",{className:"text-4xl font-bold text-white",children:ue})]}),e.jsxs("div",{className:"bg-slate-800/50 p-6 rounded-lg",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-300 mb-3",children:"Low Stock Items"}),e.jsx("p",{className:"text-4xl font-bold text-white",children:he})]})]}),"admin"===le&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6 flex items-center space-x-4",children:[e.jsx(a,{onFileUpload:async e=>{const t=`upload_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;B(t);const r=new FormData;r.append("file",e),r.append("uploadId",t);try{const e=await fetch(m("/api/inventory/upload-csv"),{method:"POST",credentials:"include",body:r}),t=await e.json();if(!e.ok)throw new Error(t.message||"Upload failed");t.errorDetails&&t.errorDetails.length>0&&Y(t.errorDetails),await me(),ye(),t.uploadId||alert(`${t.message}\n\nCreated: ${t.created} products`)}catch(a){throw new Error(a instanceof Error?a.message:"Network error")}},buttonLabel:"Upload CSV",showProgress:!0,uploadId:O||void 0,onProcessingErrors:Y}),e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg flex items-center",children:[e.jsx("h3",{className:"text-sm font-semibold text-blue-800 dark:text-blue-200 mr-2",children:"CSV Upload Format:"}),e.jsxs("div",{className:"relative group",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"w-4 h-4 text-blue-600 dark:text-blue-300 cursor-pointer",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z"})}),e.jsxs("div",{className:"absolute left-1/2 transform -translate-x-1/2 bottom-full mb-2 w-64 p-3 rounded-lg shadow-lg bg-gray-800 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-300 z-10",children:[e.jsx("p",{className:"mb-1",children:"Your CSV file should include these columns:"}),e.jsx("p",{className:"font-mono",children:"product_name, category, brand, description, stock_quantity, reorder_level, unit_price"}),e.jsxs("p",{className:"mt-2",children:[e.jsx("strong",{children:"Example:"})," iPhone 15, Electronics, Apple, Latest iPhone model, 50, 10, 25000.00"]}),e.jsxs("p",{className:"mt-1",children:[e.jsx("strong",{children:"Note:"})," SKU will be auto-generated for each product"]}),e.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 w-3 h-3 bg-gray-800 rotate-45"})]})]})]})]}),e.jsx("div",{className:"mb-6 space-y-2",children:e.jsx("button",{onClick:()=>{T({name:"",category:"",brand:"",description:"",stock:0,reorderLevel:0,unitPrice:0,hsn_code:"",gst_rate:18}),I(!0)},className:"bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out",children:"Add New Product"})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center mb-6 space-y-4 sm:space-y-0 sm:space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(s,{onDownloadCSV:()=>{const e=[["Product Name","SKU","Category","Unit Price","Stock Quantity","Reorder Level","Status"],...re.map(e=>[e.product_name,e.sku,e.category||"Uncategorized",e.unit_price||0,e.quantity_available||0,e.reorder_level||0,e.is_low_stock?"Low Stock":"In Stock"])].map(e=>e.map(e=>`"${e}"`).join(",")).join("\n"),t=new Blob([e],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a"),a=URL.createObjectURL(t);r.setAttribute("href",a),r.setAttribute("download",`inventory_${(new Date).toISOString().split("T")[0]}.csv`),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r)},onDownloadExcel:()=>{const e=re.map(e=>[e.product_name,e.sku,e.category||"Uncategorized",e.unit_price||0,e.quantity_available||0,e.reorder_level||0,e.is_low_stock?"Low Stock":"In Stock"]),t=n.aoa_to_sheet([["Product Name","SKU","Category","Unit Price","Stock Quantity","Reorder Level","Status"],...e]),r=n.book_new();n.book_append_sheet(r,t,"Inventory"),l(r,`inventory_${(new Date).toISOString().split("T")[0]}.xlsx`)},onDownloadPDF:()=>{const e=new d;e.setFontSize(16),e.text("Inventory Report",14,15),e.setFontSize(10),e.text(`Generated on: ${(new Date).toLocaleDateString()}`,14,25);const t=re.map(e=>[e.product_name,e.sku,e.category||"Uncategorized",e.unit_price?u(e.unit_price):"₹0.00",e.quantity_available||0,e.reorder_level||0,e.is_low_stock?"Low Stock":"In Stock"]);o(e,{head:[["Product Name","SKU","Category","Unit Price","Stock Quantity","Reorder Level","Status"]],body:t,startY:35,styles:{fontSize:8},headStyles:{fillColor:[66,139,202]}}),e.save(`inventory_${(new Date).toISOString().split("T")[0]}.pdf`)}}),V.length>0&&e.jsxs("button",{onClick:()=>Q(!0),className:"px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 transition-colors flex items-center space-x-2",title:"View processing errors",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),e.jsxs("span",{children:["Processing Errors (",V.length,")"]})]}),e.jsx("input",{type:"text",placeholder:"Search by product name, SKU, or ID (e.g., 1049110)",className:"p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-white w-full sm:w-80",value:N,onChange:e=>f(e.target.value)}),e.jsxs("select",{className:"p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:_,onChange:e=>S(e.target.value),children:[e.jsx("option",{value:"all",children:"All Categories"}),ae.map((t,r)=>e.jsx("option",{value:t,children:t},t||`category-${r}`))]}),e.jsxs("select",{className:"p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:C,onChange:e=>P(e.target.value),children:[e.jsx("option",{value:"all",children:"All Stock"}),e.jsx("option",{value:"in",children:"In Stock"}),e.jsx("option",{value:"low",children:"Low Stock"})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(a,{buttonLabel:"Update Stock by CSV",onFileUpload:async e=>{const t=`stock_update_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;B(t);const r=new FormData;r.append("file",e),r.append("uploadId",t);try{const e=await fetch(m("/api/inventory/update-stock-csv"),{method:"POST",credentials:"include",body:r}),t=await e.json();if(!e.ok)throw new Error(t.message||"Stock update failed");await me(),ye(),t.uploadId||alert(`${t.message}\n\nUpdated: ${t.updated} products`)}catch(a){throw new Error(a instanceof Error?a.message:"Network error")}},showProgress:!0,uploadId:O||void 0}),e.jsxs("div",{className:"relative group flex items-center",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-info text-gray-400 dark:text-gray-500 cursor-pointer",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M12 16v-4"}),e.jsx("path",{d:"M12 8h.01"})]}),e.jsxs("div",{className:"absolute bottom-full right-0 mr-4 mb-2 hidden group-hover:block w-80 p-3 bg-gray-800 text-white text-sm rounded-md shadow-lg z-10",children:[e.jsx("p",{className:"mb-1",children:"Your CSV file should include these columns:"}),e.jsx("p",{className:"font-mono",children:"product_name, sku, stock"}),e.jsxs("p",{className:"mt-2",children:[e.jsx("strong",{children:"Example:"})," Router, RT100, 50"]}),e.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 w-3 h-3 bg-gray-800 rotate-45"})]})]})]})]})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("div",{className:"hidden lg:block",children:0===re.length?e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:["No products found. ",0===y.length?"Add some products to get started.":"Try adjusting your search or filters."]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto bg-white dark:bg-gray-800 rounded-lg shadow-md",children:e.jsxs("table",{className:"w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider w-1/4",children:"Product Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider w-1/6",children:"Category"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider w-1/6",children:"Unit Price"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider w-1/12",children:"Stock"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider w-1/12",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider w-1/12",children:"View More"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider w-1/12",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:de.map((t,r)=>e.jsx(p,{product:t,userRole:le,editingPrice:F,setEditingPrice:q,handlePriceEdit:ie,handlePriceSave:ce,handlePriceCancel:xe,setManualUpdateProduct:E,setShowManualUpdateModal:M,expandedProducts:W,toggleProductExpansion:X},t.product_id||`product-${r}`))})]})}),se>1&&e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-700 dark:text-gray-300",children:["Showing ",(Z-1)*te+1," to ",Math.min(Z*te,k)," of ",k," results"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>{const e=Math.max(Z-1,1);ee(e),me(e)},disabled:1===Z,className:"px-3 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),e.jsxs("span",{className:"px-3 py-1 text-sm text-gray-700 dark:text-gray-300",children:["Page ",Z," of ",se]}),e.jsx("button",{onClick:()=>{const e=Math.min(Z+1,se);ee(e),me(e)},disabled:Z===se,className:"px-3 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})]})]})}),e.jsx("div",{className:"lg:hidden",children:0===re.length?e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:["No products found. ",0===y.length?"Add some products to get started.":"Try adjusting your search or filters."]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{height:"70vh",overflow:"auto"},className:"grid gap-4 p-4",children:de.map((t,r)=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md border border-gray-200 dark:border-gray-700 p-4 hover:shadow-lg transition-shadow",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:t.product_name}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:t.category||"Uncategorized"})]}),e.jsx("span",{className:"px-2 py-1 text-xs font-semibold rounded-full "+(t.is_low_stock?"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200":"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200"),children:t.is_low_stock?"Low Stock":"In Stock"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Unit Price"}),"admin"===le?(null==F?void 0:F.productId)===t.product_id?e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("input",{type:"number",step:"0.01",min:"0",value:(null==F?void 0:F.value)||"",onChange:e=>q({...F,value:e.target.value}),className:"w-20 px-2 py-1 text-xs border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-right",autoFocus:!0}),e.jsx("button",{onClick:()=>ce(t.product_id),className:"text-green-600 hover:text-green-800 text-xs",children:"✓"}),e.jsx("button",{onClick:xe,className:"text-red-600 hover:text-red-800 text-xs",children:"✕"})]}):e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white font-mono",children:t.unit_price&&t.unit_price>0?u(t.unit_price):"Not set"}),e.jsx("button",{onClick:()=>ie(t.product_id,Number(t.unit_price||0)),className:"text-xs text-blue-600 hover:text-blue-800 dark:text-blue-400",children:"✏️"})]}):e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white font-mono",children:t.unit_price&&t.unit_price>0?u(t.unit_price):"Not set"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Stock"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white font-mono",children:t.quantity_available||0})]})]}),e.jsx("div",{className:"mb-3",children:e.jsx("button",{onClick:()=>X(t.product_id),className:"w-full px-4 py-2 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-200 text-sm font-medium rounded border border-blue-300 hover:bg-blue-50 dark:hover:bg-blue-900 transition-colors",children:W.has(t.product_id)?"View Less":"View More"})}),W.has(t.product_id)&&e.jsx("div",{className:"mb-3 p-3 bg-gray-50 dark:bg-gray-600 rounded-lg",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Product ID"}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-white font-mono",children:t.product_id})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"SKU"}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-white font-mono",children:t.sku})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Merchant ID"}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-white font-mono",children:t.merchant_id})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Brand"}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-white",children:t.brand||"Not specified"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Reorder Level"}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-white font-mono",children:t.reorder_level||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Description"}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-white",children:t.description||"No description available"})]})]})}),"admin"===le&&e.jsx("button",{onClick:()=>{E({productId:t.product_id,productName:t.product_name,sku:t.sku,brand:t.brand||"",description:t.description||"",stock:t.quantity_available||0,reorderLevel:t.reorder_level||0,hsn_code:t.hsn_code||"",gst_rate:t.gst_rate||18}),M(!0)},className:"w-full mt-2 px-4 py-2 bg-indigo-600 text-white text-sm font-medium rounded-md hover:bg-indigo-700 transition-colors",children:"Update Product"})]},t.product_id||`product-${r}`))}),se>1&&e.jsxs("div",{className:"flex items-center justify-between px-4 py-4 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-700 dark:text-gray-300",children:["Showing ",(Z-1)*te+1," to ",Math.min(Z*te,k)," of ",k]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>{const e=Math.max(Z-1,1);ee(e),me(e)},disabled:1===Z,className:"px-3 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",children:"←"}),e.jsxs("span",{className:"px-3 py-1 text-sm text-gray-700 dark:text-gray-300",children:[Z,"/",se]}),e.jsx("button",{onClick:()=>{const e=Math.min(Z+1,se);ee(e),me(e)},disabled:Z===se,className:"px-3 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",children:"→"})]})]})]})})]}),L&&r.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-[9999] p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Add New Product"}),e.jsx("button",{onClick:()=>I(!1),className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Product Name:"}),e.jsx("input",{type:"text",placeholder:"Product Name",name:"product_name",className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:U.name,onChange:e=>T({...U,name:e.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Category:"}),e.jsx("input",{type:"text",placeholder:"Category",name:"category",className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:U.category,onChange:e=>T({...U,category:e.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Brand:"}),e.jsx("input",{type:"text",placeholder:"Brand",name:"brand",className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:U.brand,onChange:e=>T({...U,brand:e.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Description:"}),e.jsx("textarea",{placeholder:"Description",name:"description",rows:3,className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white resize-none",value:U.description,onChange:e=>T({...U,description:e.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Stock Quantity:"}),e.jsx("input",{type:"number",placeholder:"Stock Quantity",name:"stock_quantity",className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:U.stock||"",onChange:e=>T({...U,stock:parseInt(e.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Unit Price:"}),e.jsx("input",{type:"number",placeholder:"Unit Price",name:"unit_price",step:"0.01",min:"0",className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:U.unitPrice||"",onChange:e=>T({...U,unitPrice:parseFloat(e.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Reorder Level:"}),e.jsx("input",{type:"number",placeholder:"Reorder Level",name:"reorder_level",className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:U.reorderLevel||"",onChange:e=>T({...U,reorderLevel:parseInt(e.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"HSN Code (Optional):"}),e.jsx("input",{type:"text",placeholder:"HSN Code (Optional)",name:"hsn_code",maxLength:8,className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:U.hsn_code||"",onChange:e=>{const t=e.target.value;if(T({...U,hsn_code:t}),t.length>=4){const e=h(t);null!==e&&(T(r=>({...r,hsn_code:t,gst_rate:e})),R({message:`GST rate auto-filled to ${e}% based on HSN code`,type:"success"}),setTimeout(()=>R(null),3e3))}}}),z&&e.jsx("div",{className:"mt-2 p-2 rounded text-sm "+("success"===z.type?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200"),children:z.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"GST Rate:"}),e.jsxs("select",{name:"gst_rate",className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:U.gst_rate,onChange:e=>{const t=parseFloat(e.target.value);if(T({...U,gst_rate:t}),U.hsn_code&&U.hsn_code.length>=4){const e=h(U.hsn_code);null!==e&&e!==t&&(R({message:`Note: HSN code ${U.hsn_code} typically has ${e}% GST, but you selected ${t}%`,type:"warning"}),setTimeout(()=>R(null),5e3))}},children:[e.jsx("option",{value:"0",children:"0% GST"}),e.jsx("option",{value:"5",children:"5% GST"}),e.jsx("option",{value:"12",children:"12% GST"}),e.jsx("option",{value:"18",children:"18% GST (Default)"}),e.jsx("option",{value:"28",children:"28% GST"})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-6",children:[e.jsx("button",{onClick:()=>I(!1),className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:"Cancel"}),e.jsx("button",{onClick:async()=>{try{const t=await fetch(m("/api/inventory/add-product"),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(U)});if(t.ok){await t.json();const r={...U};I(!1),T({name:"",category:"",brand:"",description:"",stock:0,reorderLevel:0,unitPrice:0,hsn_code:"",gst_rate:18});try{await me(),ye();const e=await fetch(`/api/inventory?limit=50&page=${Z}`,{credentials:"include"}),t=await e.json();if(!t.products||!Array.isArray(t.products))throw new Error("Invalid response format");const a=t.products.find(e=>e.product_name===r.name&&e.category===r.category);setTimeout(()=>{alert(`Product added successfully!\n\nProduct: ${r.name}\nCategory: ${r.category}\nStock: ${r.stock}\nPrice: ${u(r.unitPrice)}${(null==a?void 0:a.sku)?`\nSKU: ${a.sku}`:""}`)},100)}catch(e){setTimeout(()=>{alert(`Product added successfully!\n\nProduct: ${r.name}\nCategory: ${r.category}\nStock: ${r.stock}\nPrice: ${u(r.unitPrice)}\n\nPlease refresh the page to see it in the list.`)},100)}}else{const e=await t.json().catch(()=>({message:"Unknown error"}));alert(`Failed to add product: ${e.message||"Unknown error"}`)}}catch(t){alert("Failed to add product: Network error")}},disabled:!U.name,className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50",children:"Add Product"})]})]})}),document.body),$&&r.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-[9999] p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Manually Update Product"}),e.jsx("button",{onClick:()=>M(!1),className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Product Name:"}),e.jsx("input",{type:"text",placeholder:"Product Name",name:"product_name",className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:D.productName,onChange:e=>E({...D,productName:e.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Brand:"}),e.jsx("input",{type:"text",placeholder:"Brand",name:"brand",className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:D.brand,onChange:e=>E({...D,brand:e.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Description:"}),e.jsx("textarea",{placeholder:"Description",name:"description",rows:3,className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white resize-none",value:D.description,onChange:e=>E({...D,description:e.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Stock Quantity:"}),e.jsx("input",{type:"number",placeholder:"Stock Quantity",name:"stock_quantity",className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:0===D.stock?"":D.stock,onChange:e=>E({...D,stock:parseInt(e.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Reorder Level:"}),e.jsx("input",{type:"number",placeholder:"Reorder Level",name:"reorder_level",className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:0===D.reorderLevel?"":D.reorderLevel,onChange:e=>E({...D,reorderLevel:parseInt(e.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"HSN Code (Optional):"}),e.jsx("input",{type:"text",placeholder:"HSN Code (Optional)",name:"hsn_code",maxLength:8,className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:D.hsn_code||"",onChange:e=>{const t=e.target.value;if(E({...D,hsn_code:t}),t.length>=4){const e=h(t);null!==e&&(E(r=>({...r,hsn_code:t,gst_rate:e})),G({message:`GST rate auto-filled to ${e}% based on HSN code`,type:"success"}),setTimeout(()=>G(null),3e3))}}}),A&&e.jsx("div",{className:"mt-2 p-2 rounded text-sm "+("success"===A.type?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200"),children:A.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"GST Rate:"}),e.jsxs("select",{name:"gst_rate",className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:D.gst_rate,onChange:e=>{const t=parseFloat(e.target.value);if(E({...D,gst_rate:t}),D.hsn_code&&D.hsn_code.length>=4){const e=h(D.hsn_code);null!==e&&e!==t&&(G({message:`Note: HSN code ${D.hsn_code} typically has ${e}% GST, but you selected ${t}%`,type:"warning"}),setTimeout(()=>G(null),5e3))}},children:[e.jsx("option",{value:"0",children:"0% GST"}),e.jsx("option",{value:"5",children:"5% GST"}),e.jsx("option",{value:"12",children:"12% GST"}),e.jsx("option",{value:"18",children:"18% GST (Default)"}),e.jsx("option",{value:"28",children:"28% GST"})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-6",children:[e.jsx("button",{onClick:()=>M(!1),className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:"Cancel"}),e.jsx("button",{onClick:async()=>{try{const e=await fetch(`/api/inventory/${D.productId}/update`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({productName:D.productName,brand:D.brand,description:D.description,quantity:D.stock,reorderLevel:D.reorderLevel,hsn_code:D.hsn_code,gst_rate:D.gst_rate})});if(e.ok)b(e=>e.map(e=>e.product_id===D.productId?{...e,product_name:D.productName,brand:D.brand,description:D.description,quantity_available:D.stock,reorder_level:D.reorderLevel,hsn_code:D.hsn_code,gst_rate:D.gst_rate}:e)),ye(),alert("Product updated successfully!"),M(!1),E({productId:0,productName:"",sku:"",brand:"",description:"",stock:0,reorderLevel:0,hsn_code:"",gst_rate:18});else{const t=await e.json();alert(`Failed to update product: ${t.message||"Unknown error"}`)}}catch(e){alert("Failed to update product")}},disabled:!D.productName,className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50",children:"Update Product"})]})]})}),document.body),K&&r.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-[9999] p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-4xl w-full mx-4 max-h-[80vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:["Processing Errors (",V.length,")"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:()=>{H([]),localStorage.removeItem("inventory-processing-errors"),Q(!1)},className:"px-3 py-1 bg-red-500 text-white text-sm rounded hover:bg-red-600 transition-colors flex items-center space-x-1",title:"Clear all errors",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),e.jsx("span",{children:"Clear"})]}),e.jsx("button",{onClick:()=>Q(!1),className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",title:"Close",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 p-4 rounded-md",children:e.jsx("div",{className:"space-y-2",children:V.map((t,r)=>e.jsxs("div",{className:"text-sm text-red-700 dark:text-red-300 break-words border-b border-red-200 dark:border-red-800 pb-2 last:border-b-0",children:[e.jsxs("span",{className:"font-medium text-red-800 dark:text-red-200",children:["#",r+1,":"]})," ",t]},r))})})}),e.jsx("div",{className:"flex justify-end mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsx("button",{onClick:()=>Q(!1),className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors",children:"Close"})})]})}),document.body)]})};export{y as default};
